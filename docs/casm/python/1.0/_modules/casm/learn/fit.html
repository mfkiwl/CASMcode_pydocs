

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>casm.learn.fit &mdash; CASM 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> CASM
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">CASM Python packages documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About CASM</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CASM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../learn.html">casm.learn</a> &raquo;</li>
        
      <li>casm.learn.fit</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for casm.learn.fit</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># conda&#39;s current version of pandas raises these warnings, but they are safe</span>
<span class="c1"># see: https://stackoverflow.com/questions/40845304</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;numpy.dtype size changed&quot;</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;numpy.ufunc size changed&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">sklearn.linear_model</span>
<span class="kn">import</span> <span class="nn">sklearn.model_selection</span>
<span class="kn">import</span> <span class="nn">sklearn.metrics</span>
<span class="kn">import</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">types</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">copy</span><span class="o">,</span> <span class="nn">uuid</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">funcsigs</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">splitext</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">join</span>

<span class="kn">import</span> <span class="nn">casm.learn.linear_model</span>
<span class="kn">import</span> <span class="nn">casm.learn.tools</span>
<span class="kn">import</span> <span class="nn">casm.learn.selection_wrapper</span>
<span class="kn">from</span> <span class="nn">casm.misc</span> <span class="kn">import</span> <span class="n">noindent</span>
<span class="kn">from</span> <span class="nn">casm.project</span> <span class="kn">import</span> <span class="n">Project</span><span class="p">,</span> <span class="n">Selection</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">write_eci</span>


<span class="k">def</span> <span class="nf">_find_method</span><span class="p">(</span><span class="n">mods</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mods</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">attrname</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">attrname</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Could not find a method named:&quot;</span><span class="p">,</span> <span class="n">attrname</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tried:&quot;</span><span class="p">,</span> <span class="n">mods</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Could not find: &quot;</span> <span class="o">+</span> <span class="n">attrname</span><span class="p">)</span>


<div class="viewcode-block" id="example_input_Lasso"><a class="viewcode-back" href="../../../reference/casm.learn.example_input_Lasso.html#casm.learn.example_input_Lasso">[docs]</a><span class="k">def</span> <span class="nf">example_input_Lasso</span><span class="p">():</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">specs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># data</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;selection&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;corr&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;formation_energy&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># sample weighting</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;wHullDist&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;kT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>

    <span class="c1"># cross validation</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;KFold&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;n_splits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;shuffle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;penalty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specs</span>

    <span class="c1"># regression estimator</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Lasso&quot;</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-4</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;max_iter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e6</span>

    <span class="c1"># feature selection</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SelectFromModel&quot;</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># hall of fame</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;n_halloffame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>

    <span class="k">return</span> <span class="nb">input</span></div>


<div class="viewcode-block" id="example_input_LassoCV"><a class="viewcode-back" href="../../../reference/casm.learn.example_input_LassoCV.html#casm.learn.example_input_LassoCV">[docs]</a><span class="k">def</span> <span class="nf">example_input_LassoCV</span><span class="p">():</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">specs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># data</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;selection&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;corr&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;formation_energy&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># sample weighting</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;wHullDist&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;kT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>

    <span class="c1"># cross validation</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;KFold&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;n_splits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;shuffle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;penalty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specs</span>

    <span class="c1"># regression estimator</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LassoCV&quot;</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;eps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-6</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;n_alphas&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;max_iter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e6</span>

    <span class="c1"># feature selection</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SelectFromModel&quot;</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># hall of fame</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;n_halloffame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>

    <span class="k">return</span> <span class="nb">input</span></div>


<div class="viewcode-block" id="example_input_RFE"><a class="viewcode-back" href="../../../reference/casm.learn.example_input_RFE.html#casm.learn.example_input_RFE">[docs]</a><span class="k">def</span> <span class="nf">example_input_RFE</span><span class="p">():</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">specs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># data</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;selection&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;corr&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;formation_energy&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># sample weighting</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;wHullDist&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;kT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>

    <span class="c1"># cross validation</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;KFold&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;n_splits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;shuffle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;penalty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specs</span>

    <span class="c1"># regression estimator</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LinearRegression&quot;</span>

    <span class="c1"># feature selection</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RFE&quot;</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;n_features_to_select&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>

    <span class="c1"># hall of fame</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;n_halloffame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>

    <span class="k">return</span> <span class="nb">input</span></div>


<div class="viewcode-block" id="example_input_GeneticAlgorithm"><a class="viewcode-back" href="../../../reference/casm.learn.example_input_GeneticAlgorithm.html#casm.learn.example_input_GeneticAlgorithm">[docs]</a><span class="k">def</span> <span class="nf">example_input_GeneticAlgorithm</span><span class="p">():</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">specs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># data</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;selection&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;corr&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;formation_energy&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># sample weighting</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;wHullDist&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;kT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>

    <span class="c1"># cross validation</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;KFold&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;n_splits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;shuffle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;penalty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specs</span>

    <span class="c1"># regression estimator</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LinearRegression&quot;</span>

    <span class="c1"># feature selection</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GeneticAlgorithm&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;constraints_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;n_features_max&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n_features_min&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;fix_off&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;fix_on&quot;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">},</span>
        <span class="s2">&quot;selTournamentSize&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;mutFlipBitProb&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="s2">&quot;evolve_params_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;n_generation&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;n_repetition&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="s2">&quot;n_features_init&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;n_population&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s2">&quot;n_halloffame&quot;</span><span class="p">:</span> <span class="mi">50</span>
        <span class="p">},</span>
        <span class="s2">&quot;cxUniformProb&quot;</span><span class="p">:</span> <span class="mf">0.5</span>
    <span class="p">}</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>

    <span class="c1"># hall of fame</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;n_halloffame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>

    <span class="k">return</span> <span class="nb">input</span></div>


<div class="viewcode-block" id="example_input_IndividualBestFirst"><a class="viewcode-back" href="../../../reference/casm.learn.example_input_IndividualBestFirst.html#casm.learn.example_input_IndividualBestFirst">[docs]</a><span class="k">def</span> <span class="nf">example_input_IndividualBestFirst</span><span class="p">():</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">specs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># data</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;selection&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;corr&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;formation_energy&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># sample weighting</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;wHullDist&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;kT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>

    <span class="c1"># cross validation</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;KFold&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;n_splits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;shuffle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;penalty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specs</span>

    <span class="c1"># regression estimator</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LinearRegression&quot;</span>

    <span class="c1"># feature selection</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;IndividualBestFirst&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;constraints_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;n_features_max&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n_features_min&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;fix_off&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;fix_on&quot;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">},</span>
        <span class="s2">&quot;evolve_params_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;n_generation&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;n_repetition&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="s2">&quot;n_features_init&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;n_population&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;n_halloffame&quot;</span><span class="p">:</span> <span class="mi">50</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>

    <span class="c1"># hall of fame</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;n_halloffame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>

    <span class="k">return</span> <span class="nb">input</span></div>


<div class="viewcode-block" id="example_input_PopulationBestFirst"><a class="viewcode-back" href="../../../reference/casm.learn.example_input_PopulationBestFirst.html#casm.learn.example_input_PopulationBestFirst">[docs]</a><span class="k">def</span> <span class="nf">example_input_PopulationBestFirst</span><span class="p">():</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">specs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># data</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;selection&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;corr&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;formation_energy&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># sample weighting</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;wHullDist&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;kT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>

    <span class="c1"># cross validation</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;KFold&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;n_splits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;shuffle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;penalty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specs</span>

    <span class="c1"># regression estimator</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LinearRegression&quot;</span>

    <span class="c1"># feature selection</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PopulationBestFirst&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;constraints_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;n_features_max&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n_features_min&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;fix_off&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;fix_on&quot;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">},</span>
        <span class="s2">&quot;evolve_params_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;n_generation&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;n_repetition&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="s2">&quot;n_features_init&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;n_population&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
            <span class="s2">&quot;n_halloffame&quot;</span><span class="p">:</span> <span class="mi">50</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>

    <span class="c1"># hall of fame</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;n_halloffame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>

    <span class="k">return</span> <span class="nb">input</span></div>


<div class="viewcode-block" id="example_input_DirectSelection"><a class="viewcode-back" href="../../../reference/casm.learn.example_input_DirectSelection.html#casm.learn.example_input_DirectSelection">[docs]</a><span class="k">def</span> <span class="nf">example_input_DirectSelection</span><span class="p">():</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">specs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># data</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;selection&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;corr&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;formation_energy&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># sample weighting</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;wHullDist&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;kT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>

    <span class="c1"># cross validation</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;KFold&quot;</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;n_splits&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;shuffle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;penalty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specs</span>

    <span class="c1"># regression estimator</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LinearRegression&quot;</span>

    <span class="c1"># feature selection</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DirectSelection&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;use_saved_estimator&quot;</span><span class="p">:</span>
        <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;population&quot;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="s2">&quot;from_halloffame&quot;</span><span class="p">:</span> <span class="s2">&quot;my_halloffame.pkl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;individuals&quot;</span><span class="p">:</span> <span class="n">noindent</span><span class="o">.</span><span class="n">NoIndent</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s2">&quot;bitstring&quot;</span><span class="p">:</span> <span class="s2">&quot;111000&quot;</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="n">noindent</span><span class="o">.</span><span class="n">NoIndent</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">21</span><span class="p">])</span>
        <span class="p">}]</span>
    <span class="p">}</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>

    <span class="c1"># hall of fame</span>
    <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;n_halloffame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>

    <span class="k">return</span> <span class="nb">input</span></div>


<div class="viewcode-block" id="print_input_help"><a class="viewcode-back" href="../../../reference/casm.learn.print_input_help.html#casm.learn.print_input_help">[docs]</a><span class="k">def</span> <span class="nf">print_input_help</span><span class="p">():</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  Settings file description:</span>
<span class="s2">  ------------------------------------------------------------------------------</span>
<span class="s2">  {</span>

<span class="s2">  # The &quot;problem_specs&quot; options specify which data to use and how to score</span>
<span class="s2">  # candidate solutions. It consists primarily of &quot;data&quot;, &quot;weight&quot;, and &quot;cv&quot;</span>
<span class="s2">  # settings.</span>

<span class="s2">    &quot;problem_specs&quot; : {</span>

<span class="s2">  # The &quot;problem_specs&quot;/&quot;data&quot; options specify the data to use for learning</span>
<span class="s2">  #</span>
<span class="s2">  #   A filename and filetype describing where to find data to use for learning.</span>
<span class="s2">  #   Also includes the labels of the sample (&#39;X&#39;) and target (&#39;y&#39;) data to use</span>
<span class="s2">  #   and kwargs containing additional options.</span>
<span class="s2">  #</span>
<span class="s2">  #</span>
<span class="s2">  # Object attributes</span>
<span class="s2">  # -----------------</span>
<span class="s2">  #</span>
<span class="s2">  # filename: string, optional, default=&quot;train&quot;</span>
<span class="s2">  #   The path to a file containing the training data</span>
<span class="s2">  #</span>
<span class="s2">  # filetype: string, optional, default=&quot;selection&quot;</span>
<span class="s2">  #   Options:</span>
<span class="s2">  #     &quot;selection&quot;: path to a CASM selection file. Only the selected</span>
<span class="s2">  #        configurations included in the file will be used for training. The</span>
<span class="s2">  #        data, typically correlations and a property, can be queried separately</span>
<span class="s2">  #        and do not need to be included. If they do exist, the data in the file</span>
<span class="s2">  #        will be used.</span>
<span class="s2">  #     &quot;csv&quot;: path to a CSV file</span>
<span class="s2">  #     &quot;json&quot;: path to a JSON file</span>
<span class="s2">  #</span>
<span class="s2">  # X: string, optional, default=&quot;corr&quot;</span>
<span class="s2">  #   The name of sample data. Expected to take the form &quot;X(0)&quot;, &quot;X(1)&quot;, etc...</span>
<span class="s2">  #</span>
<span class="s2">  # y: string, optional, default=&quot;formation_energy&quot;</span>
<span class="s2">  #   The name of the target value to train with.</span>
<span class="s2">  #</span>
<span class="s2">  # kwargs: dict or null, optional, default=dict()</span>
<span class="s2">  #   Additional parameters to be used to get training data.</span>
<span class="s2">  #</span>
<span class="s2">  #   Options for &#39;filetype&#39; &quot;selection&quot;:</span>
<span class="s2">  #     &quot;project_path&quot;: indicate the path to a CASM project. Default null uses</span>
<span class="s2">  #       the CASM project containing the current working directory. This option</span>
<span class="s2">  #       is not currently implemented, but included as a placeholder. Currently</span>
<span class="s2">  #       &#39;casm-learn&#39; must be run from inside a CASM project.</span>
<span class="s2">  #</span>
<span class="s2">  #   Options for &#39;filetype&#39; &quot;csv&quot;:</span>
<span class="s2">  #     Any options to pass to pandas.read_csv</span>
<span class="s2">  #</span>
<span class="s2">  #   Options for &#39;filetype&#39; &quot;json&quot;:</span>
<span class="s2">  #     Any options to pass to pandas.read_json</span>

<span class="s2">      &quot;data&quot; : {</span>
<span class="s2">        &quot;filename&quot;: &quot;train&quot;,</span>
<span class="s2">        &quot;filetype&quot;: &quot;selection&quot;,</span>
<span class="s2">        &quot;X&quot;: &quot;corr&quot;,</span>
<span class="s2">        &quot;y&quot;: &quot;formation_energy&quot;,</span>
<span class="s2">        &quot;kwargs&quot;: null</span>
<span class="s2">      },</span>

<span class="s2">  # The &quot;problem_specs&quot;/&quot;weight&quot; options specify the method to use for weighting</span>
<span class="s2">  # training data.</span>
<span class="s2">  #</span>
<span class="s2">  #   Ordinary least squares minimizes</span>
<span class="s2">  #     (y-X*b).transpose() * (y-X*b)</span>
<span class="s2">  #</span>
<span class="s2">  #   where &#39;X&#39; is the correlation matrix of shape (Nvalue, Nbfunc), and &#39;y&#39;</span>
<span class="s2">  #   is a vector of Nvalue calculated properties, and &#39;b&#39; are the fitting</span>
<span class="s2">  #   coefficients (ECI).</span>
<span class="s2">  #</span>
<span class="s2">  #   Weighted least squares minimizes</span>
<span class="s2">  #     (y-X*b).transpose() * W * (y-X*b)</span>
<span class="s2">  #</span>
<span class="s2">  #   Using the SVD, and given that W is Hermitian:</span>
<span class="s2">  #     U * S * U.transpose() == W</span>
<span class="s2">  #</span>
<span class="s2">  #   Define L such that:</span>
<span class="s2">  #     L.transpose() = U * sqrt(S)</span>
<span class="s2">  #</span>
<span class="s2">  #   Then we can write the weighted least squares problem using:</span>
<span class="s2">  #     (y-X*b).transpose() * L.transpose() * L * (y-X*b)</span>
<span class="s2">  #</span>
<span class="s2">  #   Or:</span>
<span class="s2">  #     (L*y-L*X*b).transpose() * (L*y-L*X*b)</span>
<span class="s2">  #</span>
<span class="s2">  #   So, if weights are included, then the linear model is changed from</span>
<span class="s2">  #     X*b = y  -&gt;  L*X*b = L*y</span>
<span class="s2">  #</span>
<span class="s2">  #   By default, W = np.matlib.eye(Nvalue) (unweighted).</span>
<span class="s2">  #</span>
<span class="s2">  #   If the weighting method provides 1-dimensional input (this is typical), in</span>
<span class="s2">  #   a numpy array called &#39;w&#39;:</span>
<span class="s2">  #     W = np.diag(w)*Nvalue/np.sum(w)</span>
<span class="s2">  #</span>
<span class="s2">  #   If the &#39;custom2d&#39; method is used, the input W_in must by Hermitian,</span>
<span class="s2">  #   positive-definite and is normalized by:</span>
<span class="s2">  #     W = W_in*Nvalue/np.sum(W_in)</span>
<span class="s2">  #</span>
<span class="s2">  #</span>
<span class="s2">  # Object attributes</span>
<span class="s2">  # -----------------</span>
<span class="s2">  #</span>
<span class="s2">  # method: string, optional, default=null</span>
<span class="s2">  #   The weighting method to use</span>
<span class="s2">  #</span>
<span class="s2">  #   Options:</span>
<span class="s2">  #   &#39;wHullDist&#39;: Weight according to w_i = A*exp(-hull_dist/kT) + B, where A, B,</span>
<span class="s2">  #     and kT are user-defined kwargs parameters, and hull_dist is the distance</span>
<span class="s2">  #     from the convex hull of the training data, using the kwarg &quot;hull_selection&quot;</span>
<span class="s2">  #     to determine which selection of configurations to use to find the hull.</span>
<span class="s2">  #     The default hull_selection is &quot;CALCULATED&quot;.</span>
<span class="s2">  #   &#39;wEmin&#39;: Weight according to w_i = A*exp(-dist_from_minE/kT) + B,</span>
<span class="s2">  #     where A, B, and kT are user-defined kwargs parameters, and dist_from_minE</span>
<span class="s2">  #     is calculated from the training data</span>
<span class="s2">  #   &#39;wEref&#39;: weight according to w_i = A*exp(-(formation_energy - E0)/kT) + B, for</span>
<span class="s2">  #     (formation_energy - E0) &gt; 0.0; and w_i = 1.0 if (formation_energy - E0) &lt;= 0.0.</span>
<span class="s2">  #     where A, B, E0, and kT are user-defined kwargs parameters.</span>
<span class="s2">  #   &#39;wCustom&#39;: Weights are read from a column titled &#39;weight&#39; in the training data</span>
<span class="s2">  #     selection file.</span>
<span class="s2">  #   &#39;wCustom2d&#39;: Weights are read from columns in the training data selection file,</span>
<span class="s2">  #     which are expected to be titled &#39;weight(0)&#39; ... &#39;weight(Nvalue-1)&#39;</span>
<span class="s2">  #</span>
<span class="s2">  #</span>
<span class="s2">  # kwargs: dict or null, optional, default=dict()</span>
<span class="s2">  #   Additional parameters to be used to construct the estimator</span>
<span class="s2">  #</span>
<span class="s2">  #   Options: (as described above)</span>
<span class="s2">  #     &quot;A&quot;: float</span>
<span class="s2">  #     &quot;B&quot;: float</span>
<span class="s2">  #     &quot;kT&quot;: float</span>
<span class="s2">  #     &quot;E0&quot;: float</span>
<span class="s2">  #     &quot;hull_selection&quot;: string</span>

<span class="s2">      &quot;weight&quot;: {</span>
<span class="s2">        &quot;method&quot;: null,</span>
<span class="s2">        &quot;kwargs&quot;: null</span>
<span class="s2">      },</span>

<span class="s2">  # The &quot;problem_specs&quot;/&quot;cv&quot; options specify how to generate cross validation sets.</span>
<span class="s2">  #</span>
<span class="s2">  #   The cv score reported is:</span>
<span class="s2">  #</span>
<span class="s2">  #     cv = sqrt(np.mean(scores)) + (Number of non-zero ECI)*penalty,</span>
<span class="s2">  #</span>
<span class="s2">  #   where &#39;scores&#39; is an array containing the mean squared error calculated for</span>
<span class="s2">  #   each training/testing set, &#39;(Number of non-zero ECI)&#39; is the number of basis</span>
<span class="s2">  #   functions with non-zero ECI, and &#39;penalty&#39; is the user-input penalty per basis</span>
<span class="s2">  #   function (default=0.0).</span>
<span class="s2">  #</span>
<span class="s2">  #</span>
<span class="s2">  # Object attributes</span>
<span class="s2">  # -----------------</span>
<span class="s2">  #</span>
<span class="s2">  # method: string</span>
<span class="s2">  #   A scikit-learn or casm cross validation method.</span>
<span class="s2">  #</span>
<span class="s2">  #   Options include &#39;KFold&#39;, &#39;ShuffleSplit&#39;, &#39;LeaveOneOut&#39;, etc.</span>
<span class="s2">  #     See: http://scikit-learn.org/stable/modules/model_selection.html</span>
<span class="s2">  #</span>
<span class="s2">  #   CASM also provides the following method:</span>
<span class="s2">  #    &#39;cvCustom&#39;: Read a scikit-learn type &#39;cv&#39; generator or training/test sets</span>
<span class="s2">  #       from a pickle file. This can be used to load the &#39;cv&#39; data written by</span>
<span class="s2">  #       &#39;casm-learn --checkspecs&#39; by using the required kwarg &#39;filename&#39;.</span>
<span class="s2">  #</span>
<span class="s2">  #     Note: The &#39;LinearRegression&#39; estimator is implemented using</span>
<span class="s2">  #     casm.learn.linear_model.LinearRegressionForLOOCV&#39;, which solves X*b=y using:</span>
<span class="s2">  #       S = np.linalg.pinv(X.transpose().dot(X)).dot(X.transpose())</span>
<span class="s2">  #       b = np.dot(S, y)</span>
<span class="s2">  #       H = np.dot(X, S)</span>
<span class="s2">  #       y_pred = np.dot(H, y)</span>
<span class="s2">  #</span>
<span class="s2">  #     Note: When the estimator is &#39;LinearRegression&#39;, the &#39;LeaveOneOut&#39;</span>
<span class="s2">  #     cross-validation score is calculated via:</span>
<span class="s2">  #</span>
<span class="s2">  #       LOOCV = np.mean(((y - y_pred)/(1.0 - np.diag(H)))**2)</span>
<span class="s2">  #</span>
<span class="s2">  # kwargs: dict or null, optional, default=dict()</span>
<span class="s2">  #   Additional parameters to be used to construct the cross-validation method</span>
<span class="s2">  #   constructor.</span>
<span class="s2">  #</span>
<span class="s2">  # penalty: float, optional, default=0.0</span>
<span class="s2">  #   The CV score is increased by &#39;penalty*(number of selected basis function)&#39;</span>

<span class="s2">      &quot;cv&quot;: {</span>
<span class="s2">        &quot;method&quot;: &quot;KFold&quot;,</span>
<span class="s2">        &quot;kwargs&quot;: {</span>
<span class="s2">          &quot;n_splits&quot;: 10,</span>
<span class="s2">          &quot;shuffle&quot;: true</span>
<span class="s2">        },</span>
<span class="s2">        &quot;penalty&quot;: 0.0</span>
<span class="s2">      },</span>

<span class="s2">  # The &quot;problem_specs&quot;/&quot;specs_filename&quot; option:</span>
<span class="s2">  #</span>
<span class="s2">  # Optional. Name to use for file storing the training data and CV train/test</span>
<span class="s2">  # sets. The default is determined from the input filename, for example,</span>
<span class="s2">  # &#39;my_input_specs.pkl&#39; is used if the input file is named &#39;my_input.json&#39;.</span>

<span class="s2">      &quot;specs_filename&quot;: &quot;problem_specs.pkl&quot;</span>

<span class="s2">    },</span>

<span class="s2">  # The &quot;estimator&quot; option specifies a linear model estimator.</span>
<span class="s2">  #</span>
<span class="s2">  # Object attributes</span>
<span class="s2">  # -----------------</span>
<span class="s2">  #</span>
<span class="s2">  # method: string</span>
<span class="s2">  #   A scikit-learn linear model estimator.</span>
<span class="s2">  #</span>
<span class="s2">  #   Options: &#39;LinearRegression&#39;, &#39;Ridge&#39;, &#39;Lasso&#39;, &#39;LassoCV&#39;, etc.</span>
<span class="s2">  #     See: http://scikit-learn.org/stable/modules/linear_model.html</span>
<span class="s2">  #</span>
<span class="s2">  #   Note: The &#39;LinearRegression&#39; estimator is implemented using</span>
<span class="s2">  #   casm.learn.linear_model.LinearRegressionForLOOCV&#39;, which solves X*b=y using:</span>
<span class="s2">  #     b = np.dot(S, y)</span>
<span class="s2">  #     S = np.linalg.pinv(X.transpose().dot(X)).dot(X.transpose())</span>
<span class="s2">  #     y_pred = np.dot(H, y)</span>
<span class="s2">  #     H = np.dot(X, S)</span>
<span class="s2">  #</span>
<span class="s2">  # kwargs: dict or null, optional, default=dict()</span>
<span class="s2">  #   Additional parameters to be used to construct the estimator</span>
<span class="s2">  #</span>
<span class="s2">  #   Options for &quot;LinearRegression&quot;:</span>
<span class="s2">  #     &quot;pinv&quot;: bool, optional, default=True</span>
<span class="s2">  #       If True, use the pseudo-inverse via np.linalg.pinv; else use np.linalg.inv.</span>
<span class="s2">  #</span>
<span class="s2">  #   Options for other methods:</span>
<span class="s2">  #     Any options to pass to the estimator construtor.</span>
<span class="s2">  #</span>
<span class="s2">  #   By default, the kwarg &quot;fit_intercept&quot; is set to False.</span>

<span class="s2">    &quot;estimator&quot;: {</span>
<span class="s2">      &quot;method&quot;: &quot;LinearRegression&quot;,</span>
<span class="s2">      &quot;kwargs&quot;: null</span>
<span class="s2">    },</span>


<span class="s2">  # The &quot;feature_selection&quot; option specifies a feature selection method.</span>
<span class="s2">  #</span>
<span class="s2">  # Object attributes</span>
<span class="s2">  # -----------------</span>
<span class="s2">  #</span>
<span class="s2">  # method: string</span>
<span class="s2">  #   A scikit-learn or casm.learn.feature_selection feature selection method.</span>
<span class="s2">  #</span>
<span class="s2">  #   Options from sklearn.feature_selection: &quot;SelectFromModel&quot;, &quot;RFE&quot;, etc.</span>
<span class="s2">  #     See: http://scikit-learn.org/stable/modules/feature_selection.html</span>
<span class="s2">  #</span>
<span class="s2">  #   Options from casm.learn.feature_selection:</span>
<span class="s2">  #</span>
<span class="s2">  #   &quot;DirectSelection&quot;: Allows directly specifying which basis functions should</span>
<span class="s2">  #     be included.</span>
<span class="s2">  #</span>
<span class="s2">  #     Options for &quot;kwargs&quot;:</span>
<span class="s2">  #</span>
<span class="s2">  #       &quot;population&quot;: List[dict]</span>
<span class="s2">  #          Contains a list of options specifying which individuals to fit.</span>
<span class="s2">  #          Options are:</span>
<span class="s2">  #</span>
<span class="s2">  #            &quot;bitstring&quot;: Ex.: {&quot;bitstring&quot; : &quot;01110001100&quot;}</span>
<span class="s2">  #              String consisting of &#39;0&#39; and &#39;1&#39;, with &#39;1&#39; corresponding to</span>
<span class="s2">  #              selected basis functions. May be shorter than the total number</span>
<span class="s2">  #              of possible basis functions, in which case &#39;0&#39; are effectively</span>
<span class="s2">  #              padded to the end.</span>
<span class="s2">  #</span>
<span class="s2">  #            &quot;indices&quot;: Ex.: {&quot;indices&quot; : [1, 2, 3, 7, 8]}</span>
<span class="s2">  #              List of indices of basis functions to be selected.</span>
<span class="s2">  #</span>
<span class="s2">  #            &quot;from_halloffame&quot;: Ex.: { &quot;from_halloffame&quot; : &quot;my_halloffame.pkl&quot;,</span>
<span class="s2">  #                                      &quot;individuals&quot; : [0, 2, 5]}</span>
<span class="s2">  #               Specifies a hall of fame .pkl file and particular individuals</span>
<span class="s2">  #               in the hall (by index) to include in the population. The</span>
<span class="s2">  #               &quot;individuals&quot; list is optional, with the default behaviour</span>
<span class="s2">  #               including all individuals in the hall of fame.</span>
<span class="s2">  #</span>
<span class="s2">  #       &quot;use_saved_estimator&quot;: boolean, optional, default=False</span>
<span class="s2">  #          If True, and individuals in the input population come from a HallOfFame</span>
<span class="s2">  #          the estimator method stored in the individual&#39;s saved input file will</span>
<span class="s2">  #          be used instead of the estimator specified in the current input file.</span>
<span class="s2">  #</span>
<span class="s2">  #</span>
<span class="s2">  #   Evolutionary algorithms, from casm.learn.feature_selection, are implemented</span>
<span class="s2">  #   using deap: http://deap.readthedocs.org/en/master/index.html</span>
<span class="s2">  #</span>
<span class="s2">  #   &quot;GeneticAlgorithm&quot;: Implements deap.algorithms.eaSimple, using selTournament,</span>
<span class="s2">  #     for selection, cxUniform for mating, and mutFlipBit for mutation. The</span>
<span class="s2">  #     probability of mating and mutating is set to 1.0.</span>
<span class="s2">  #</span>
<span class="s2">  #     Options for &quot;kwargs&quot;:</span>
<span class="s2">  #</span>
<span class="s2">  #       &quot;selTournamentSize&quot;: int, optional, default=3</span>
<span class="s2">  #          Tournament size. A larger tournament size weeds out less fit</span>
<span class="s2">  #          individuals more quickly, while a smaller tournament size weeds out</span>
<span class="s2">  #          less fit individuals more gradually.</span>
<span class="s2">  #</span>
<span class="s2">  #       &quot;cxUniformProb&quot;: float, optional, default=0.5</span>
<span class="s2">  #          Probability of swapping bits during mating.</span>
<span class="s2">  #</span>
<span class="s2">  #       &quot;mutFlipBitProb&quot;: float, optional, default=0.01</span>
<span class="s2">  #          Probability of mutating bits</span>
<span class="s2">  #</span>
<span class="s2">  #       &quot;constraints_kwargs&quot;: dict, optional, default=dict()</span>
<span class="s2">  #          Keyword arguments for setting constraints on allowed individuals.</span>
<span class="s2">  #          See below for options.</span>
<span class="s2">  #</span>
<span class="s2">  #       &quot;evolve_params_kwargs&quot;: dict, optional, default=dict()</span>
<span class="s2">  #          Keyword arguments for controlling how long the algorithm runs, how</span>
<span class="s2">  #          new random individuals are initialized, when restart files are</span>
<span class="s2">  #          written, and the names of the files. See below for options.</span>
<span class="s2">  #</span>
<span class="s2">  #</span>
<span class="s2">  #   &quot;IndividualBestFirst&quot;:</span>
<span class="s2">  #     Implements a best first search optimization for each individual in the initial</span>
<span class="s2">  #     population. Each individual in the population is minimized by repeatedly begin</span>
<span class="s2">  #     replaced by its most fit child.</span>
<span class="s2">  #</span>
<span class="s2">  #     Children are generated by generating all the individual that differ from</span>
<span class="s2">  #     the parent by +/- 1 selected feature.</span>
<span class="s2">  #</span>
<span class="s2">  #</span>
<span class="s2">  #     Options for &quot;kwargs&quot;:</span>
<span class="s2">  #</span>
<span class="s2">  #       &quot;constraints_kwargs&quot;: dict, optional, default=dict()</span>
<span class="s2">  #          Keyword arguments for setting constraints on allowed individuals.</span>
<span class="s2">  #          See below for options.</span>
<span class="s2">  #</span>
<span class="s2">  #       &quot;evolve_params_kwargs&quot;: dict, optional, default=dict()</span>
<span class="s2">  #          Keyword arguments for controlling how long the algorithm runs, how</span>
<span class="s2">  #          new random individuals are initialized, when restart files are</span>
<span class="s2">  #          written, and the names of the files. See below for options.</span>
<span class="s2">  #</span>
<span class="s2">  #</span>
<span class="s2">  #   &quot;PopulationBestFirst&quot;:</span>
<span class="s2">  #     Implements a best first search optimization for a population of individual</span>
<span class="s2">  #     solutions. Each individual is associated with a &#39;status&#39; that indicates</span>
<span class="s2">  #     whether it has had children yet or not. At each step, the most fit individual</span>
<span class="s2">  #     that hasn&#39;t had children has children and the population is updated to keep</span>
<span class="s2">  #     only the &#39;n_population&#39; most fit individuals. The algorithm stops when all</span>
<span class="s2">  #     individuals in the population have had children.</span>
<span class="s2">  #</span>
<span class="s2">  #     Children are generated by generating all the individual that differ from</span>
<span class="s2">  #     the parent by +/- 1 selected feature.</span>
<span class="s2">  #</span>
<span class="s2">  #     Options for &quot;kwargs&quot;:</span>
<span class="s2">  #</span>
<span class="s2">  #       &quot;constraints_kwargs&quot;: dict, optional, default=dict()</span>
<span class="s2">  #          Keyword arguments for setting constraints on allowed individuals.</span>
<span class="s2">  #          See below for options.</span>
<span class="s2">  #</span>
<span class="s2">  #       &quot;evolve_params_kwargs&quot;: dict, optional, default=dict()</span>
<span class="s2">  #          Keyword arguments for controlling how long the algorithm runs, how</span>
<span class="s2">  #          new random individuals are initialized, when restart files are</span>
<span class="s2">  #          written, and the names of the files. See below for options.</span>
<span class="s2">  #</span>
<span class="s2">  #</span>
<span class="s2">  #   The evolutionary algorithms have an optional set of &quot;constraints_kwargs&quot;</span>
<span class="s2">  #   parameters that may restrict the number of basis functions selected to some</span>
<span class="s2">  #    range, or enforce some basis functions to have or not have coefficients:</span>
<span class="s2">  #</span>
<span class="s2">  #   Options for &quot;constraints_kwargs&quot;:</span>
<span class="s2">  #     &quot;n_features_min&quot;: int, optional, default=1</span>
<span class="s2">  #        The minimum allowed number of selected features. Must be &gt;=1.</span>
<span class="s2">  #</span>
<span class="s2">  #     &quot;n_features_max&quot;: int or str, optional, default=&quot;all&quot;</span>
<span class="s2">  #        The maximum allowed number of selected features. String &quot;all&quot; for no limit.</span>
<span class="s2">  #</span>
<span class="s2">  #     &quot;fix_on&quot;: 1d array-like of int, optional, default=[]</span>
<span class="s2">  #        The indices of features to fix on</span>
<span class="s2">  #</span>
<span class="s2">  #     &quot;fix_off&quot;: 1d array-like of int, optional, default=[]</span>
<span class="s2">  #        The indices of features to fix off</span>
<span class="s2">  #</span>
<span class="s2">  #</span>
<span class="s2">  #   The evolutionary algorithms share an optional set of &quot;evolve_params_kwargs&quot;</span>
<span class="s2">  #   parameters that control how long the algorithm runs, how new random</span>
<span class="s2">  #   individuals are initialized, when restart files are written, and the names</span>
<span class="s2">  #   of the files:</span>
<span class="s2">  #</span>
<span class="s2">  #   Options for &quot;evolve_params_kwargs&quot;:</span>
<span class="s2">  #</span>
<span class="s2">  #     &quot;n_population&quot;: int, optional, default=100</span>
<span class="s2">  #        Initial population size. This many random initial starting individuals</span>
<span class="s2">  #         are created if no &quot;pop_begin_filename&quot; file exists.</span>
<span class="s2">  #</span>
<span class="s2">  #     &quot;n_halloffame&quot;: int, optional, default=25</span>
<span class="s2">  #        Maxsize of the hall of fame which holds the best individuals</span>
<span class="s2">  #        encountered in any generation. Upon completion, the individuals in</span>
<span class="s2">  #        this hall of fame are into your overall casm-learn hall of fame to</span>
<span class="s2">  #        be compared to results obtained from other fitting or feature</span>
<span class="s2">  #        selection methods.</span>
<span class="s2">  #</span>
<span class="s2">  #     &quot;n_generation&quot;: int, optional, default=10</span>
<span class="s2">  #        Number of generations between saving the hall of fame.</span>
<span class="s2">  #</span>
<span class="s2">  #     &quot;n_repetition&quot;: int, optional, default=100</span>
<span class="s2">  #        Number of repetitions of n_generation generations. Each repetition</span>
<span class="s2">  #        begins with the existing final population.</span>
<span class="s2">  #</span>
<span class="s2">  #     &quot;n_features_init: int or &quot;all&quot;, optional, default=0</span>
<span class="s2">  #        Number of randomly selected features to initialize each individual</span>
<span class="s2">  #        with.</span>
<span class="s2">  #</span>
<span class="s2">  #     &quot;pop_begin_filename&quot;: string, optional, default=&quot;population_begin.pkl&quot;</span>
<span class="s2">  #        Filename suffix where the initial population is read from, if it</span>
<span class="s2">  #        exists. For example, if &quot;filename_prefix&quot; is &quot;Ef_kfold10&quot; and</span>
<span class="s2">  #        &quot;pop_begin_filename&quot; is &quot;population_begin.pkl&quot;, then the initial</span>
<span class="s2">  #        population is read from the file &quot;Ef_kfold10_population_begin.pkl&quot;.</span>
<span class="s2">  #</span>
<span class="s2">  #        The population file may contain either a  list of individual,</span>
<span class="s2">  #        as written to the &quot;population_end.pkl&quot; file, or a HallOfFame</span>
<span class="s2">  #        instance, as written to either an &quot;evolve_halloffame.pkl&quot; file or</span>
<span class="s2">  #        overall casm-learn &quot;halloffame.pkl&quot; file.</span>
<span class="s2">  #</span>
<span class="s2">  #     &quot;pop_end_filename&quot;: string, optional, default=&quot;population_end.pkl&quot;</span>
<span class="s2">  #        Filename where the final population is saved. For example, if</span>
<span class="s2">  #        &quot;filename_prefix&quot; is &quot;Ef_kfold10&quot; and &quot;pop_end_filename&quot; is</span>
<span class="s2">  #        &quot;population_end.pkl&quot;, then the final population is saved to the</span>
<span class="s2">  #        file &quot;Ef_kfold10_population_end.pkl&quot;.</span>
<span class="s2">  #</span>
<span class="s2">  #     &quot;halloffame_filename&quot;: string, optional, default=&quot;evolve_halloffame.pkl&quot;</span>
<span class="s2">  #        Filename where a hall of fame is saved holding the best individuals</span>
<span class="s2">  #        encountered in any generation. For example, if &quot;filename_prefix&quot; is</span>
<span class="s2">  #        &quot;Ef_kfold10&quot; and &quot;halloffame_filename&quot; is &quot;evolve_halloffame.pkl&quot;,</span>
<span class="s2">  #        then it is saved to the file &quot;Ef_kfold10_evolve_halloffame.pkl&quot;.</span>
<span class="s2">  #</span>
<span class="s2">  #     &quot;filename_prefix&quot;: string, optional</span>
<span class="s2">  #        Prefix for filenames, default uses input file filename excluding</span>
<span class="s2">  #        extension. For example, if input file is named &quot;Ef_kfold10.json&quot;, then</span>
<span class="s2">  #        &quot;Ef_kfold10_population_begin.pkl&quot;, &quot;Ef_kfold10_population_end.pkl&quot;, and</span>
<span class="s2">  #        &quot;Ef_kfold10_evolve_halloffame.pkl&quot; are used.</span>

<span class="s2">    &quot;feature_selection&quot; : {</span>
<span class="s2">      &quot;method&quot;: &quot;GeneticAlgorithm&quot;,</span>
<span class="s2">      &quot;kwargs&quot;: {</span>
<span class="s2">        &quot;selTournamentSize&quot;: 3,</span>
<span class="s2">        &quot;cxUniformProb&quot;: 0.5,</span>
<span class="s2">        &quot;mutFlipBitProb&quot;: 0.01,</span>
<span class="s2">        &quot;constraints&quot;: {</span>
<span class="s2">          &quot;n_features_min&quot;: 1,</span>
<span class="s2">          &quot;n_features_max&quot;: &quot;all&quot;,</span>
<span class="s2">          &quot;fix_on&quot;: [],</span>
<span class="s2">          &quot;fix_off&quot;: []</span>
<span class="s2">        },</span>
<span class="s2">        &quot;evolve_params_kwargs&quot;: {</span>
<span class="s2">          &quot;n_population&quot;: 100,</span>
<span class="s2">          &quot;n_generation&quot;: 10,</span>
<span class="s2">          &quot;n_repetition&quot;: 100,</span>
<span class="s2">          &quot;n_features_init&quot;: 0</span>
<span class="s2">        }</span>
<span class="s2">      }</span>
<span class="s2">    },</span>

<span class="s2">  # The &quot;halloffame_filename&quot; option:</span>
<span class="s2">  #</span>
<span class="s2">  # Optional. Default = &quot;halloffame.pkl&quot;</span>
<span class="s2">  # Name to use for file storing the best results obtained to date, as determined</span>
<span class="s2">  # by the CV score. This enables comparison of the results of various estimator</span>
<span class="s2">  # or feature selection methods.</span>

<span class="s2">      &quot;halloffame_filename&quot;: &quot;halloffame.pkl&quot;</span>

<span class="s2">    },</span>

<span class="s2">  # The &quot;n_halloffame&quot; option:</span>
<span class="s2">  #</span>
<span class="s2">  # Optional. Default = 25</span>
<span class="s2">  # The number of individuals to store in the hall of fame.</span>

<span class="s2">    &quot;n_halloffame&quot;: 25</span>

<span class="s2">  # The &quot;checkspecs&quot; option:</span>
<span class="s2">  #</span>
<span class="s2">  #   Currently, these settings are used with the &#39;--checkspecs&#39; option to control</span>
<span class="s2">  #   the output files containing training data (including calculated weights) and</span>
<span class="s2">  #   cv generators or training / testing sets.</span>
<span class="s2">  #</span>
<span class="s2">  #</span>
<span class="s2">  # Object attributes</span>
<span class="s2">  # -----------------</span>
<span class="s2">  #</span>
<span class="s2">  # data_filename: string</span>
<span class="s2">  #   The path to the file where the training data (including weights) should be</span>
<span class="s2">  #   written</span>
<span class="s2">  #</span>
<span class="s2">  # data_kwargs: dict or null, optional, default=dict()</span>
<span class="s2">  #   Additional parameters to be used to write training data.</span>
<span class="s2">  #</span>
<span class="s2">  #   Options for input &#39;filetype&#39; &quot;selection&quot;:</span>
<span class="s2">  #     None.</span>
<span class="s2">  #</span>
<span class="s2">  #   Options for input &#39;filetype&#39; &quot;csv&quot;:</span>
<span class="s2">  #     Any options to pass to pandas.to_csv</span>
<span class="s2">  #</span>
<span class="s2">  #   Options for input &#39;filetype&#39; &quot;json&quot;:</span>
<span class="s2">  #     Any options to pass to pandas.to_json</span>
<span class="s2">  #</span>
<span class="s2">  # cv_filename: string</span>
<span class="s2">  #   The path to the file where the cv generator or train/tests sets should be</span>
<span class="s2">  #   written as pickle file</span>
<span class="s2">  #</span>
<span class="s2">  # cv_kwargs: dict or null, optional, default=dict()</span>
<span class="s2">  #   Additional parameters to be used to write cv data using pickle.dump.</span>

<span class="s2">    &quot;checkspecs&quot; : {</span>
<span class="s2">      &quot;data_filename&quot;: &quot;check_train&quot;,</span>
<span class="s2">      &quot;data_kwargs&quot;: null,</span>
<span class="s2">      &quot;cv_filename&quot;: &quot;check_cv.pkl&quot;,</span>
<span class="s2">      &quot;cv_kwargs&quot;: null</span>
<span class="s2">    },</span>

<span class="s2">  # The &quot;checkhull&quot; option:</span>
<span class="s2">  #</span>
<span class="s2">  #   Currently, these settings are used with the &#39;--checkhull&#39; option to</span>
<span class="s2">  #   calculate convex hull properties.</span>
<span class="s2">  #</span>
<span class="s2">  #</span>
<span class="s2">  # Object attributes</span>
<span class="s2">  # -----------------</span>
<span class="s2">  #</span>
<span class="s2">  # selection: str, optional, default=&quot;ALL&quot;</span>
<span class="s2">  #   A CASM selection (either &#39;casm select&#39; output filename or one of the</span>
<span class="s2">  #   standard selections: &quot;MASTER&quot;, &quot;CALCULATED&quot;, or &quot;ALL&quot;) containing all the</span>
<span class="s2">  #   configurations to be considered. The DFT convex hull is generated from</span>
<span class="s2">  #   the subset of this selection for which &#39;is_calculated&#39; is true.</span>
<span class="s2">  #</span>
<span class="s2">  # write_results: bool, optional, default=False</span>
<span class="s2">  #   If True, write CASM selection files containing the output data. Output</span>
<span class="s2">  #   selection files are named &quot;checkhull_(problem_specs_prefix)_(i)_(selname)&quot;,</span>
<span class="s2">  #   where &#39;problem_specs_prefix&#39; is input[&quot;problem_specs_prefix&quot;], &#39;i&#39; is the</span>
<span class="s2">  #   index of the individual in the hall of fame, and &#39;selname&#39; is one of:</span>
<span class="s2">  #     &quot;dft_gs&quot; : DFT calculated ground states</span>
<span class="s2">  #     &quot;clex_gs&quot; : predicted ground states</span>
<span class="s2">  #     &quot;gs_missing&quot; : DFT ground states that are not predicted ground states</span>
<span class="s2">  #     &quot;gs_spurious&quot; : Predicted ground states that are not DFT ground states</span>
<span class="s2">  #     &quot;uncalculated&quot; : Predicted ground states and near ground states that have not been calculated</span>
<span class="s2">  #     &quot;below_hull&quot; : All configurations predicted below the prediction of the DFT hull</span>
<span class="s2">  #</span>
<span class="s2">  # primitive_only: bool, optional, default=True</span>
<span class="s2">  #   If True, only use primitive configurations to construct the convex hull,</span>
<span class="s2">  #   else use all selected configurations.</span>
<span class="s2">  #</span>
<span class="s2">  # uncalculated_range: number, optional, default=0.0</span>
<span class="s2">  #   Include all configurations with clex_hull_dist less than this value (+hull_tol)</span>
<span class="s2">  #   in the &quot;uncalculated&quot; configurations results. Default only includes predicted</span>
<span class="s2">  #   ground states.</span>
<span class="s2">  #</span>
<span class="s2">  # ranged_rms: List[number], optional, default=[0.001, 0.005, 0.01, 0.05, 0.1, 0.5]</span>
<span class="s2">  #   Calculates the root-mean-square error for DFT calculated configurations</span>
<span class="s2">  #   within a particular range (in eV/unitcell) of the DFT hull. The list</span>
<span class="s2">  #   provides all the ranges for which the RMSE is requested.</span>
<span class="s2">  #</span>
<span class="s2">  # composition: str, optional, default=&quot;atom_frac&quot;</span>
<span class="s2">  #   Composition argument use for &#39;casm query&#39; properties &#39;hull_dist&#39; and</span>
<span class="s2">  #   &#39;clex_hull_dist&#39;. For thermodynamic ground states, use &quot;atom_frac&quot;.</span>
<span class="s2">  #</span>
<span class="s2">  # hull_tol: number, optional, default=proj.settings.data[&quot;lin_alg_tol&quot;]</span>
<span class="s2">  #   Tolerance used for identify hull states</span>
<span class="s2">  #</span>
<span class="s2">  # dim_tol: number, optional, default=1e-8</span>
<span class="s2">  #   Tolerance for detecting composition dimensionality</span>
<span class="s2">  #</span>
<span class="s2">  # bottom_tol: number, optional, default=1e-8</span>
<span class="s2">  #   Tolerance for detecting which facets form the convex hull bottom</span>

<span class="s2">    &quot;checkhull&quot; : {</span>
<span class="s2">      &quot;selection&quot;: &quot;ALL&quot;,</span>
<span class="s2">      &quot;write_results&quot;: true,</span>
<span class="s2">      &quot;primitive_only&quot;: true,</span>
<span class="s2">      &quot;uncalculated_range&quot;: 1e-8,</span>
<span class="s2">      &quot;ranged_rms&quot;: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5],</span>
<span class="s2">      &quot;composition&quot;: &quot;atom_frac&quot;,</span>
<span class="s2">      &quot;hull_tol&quot;: 1e-8,</span>
<span class="s2">      &quot;dim_tol&quot;: 1e-8,</span>
<span class="s2">      &quot;bottom_tol&quot;: 1e-8</span>
<span class="s2">    }</span>

<span class="s2">  }</span>
<span class="s2">  ------------------------------------------------------------------------------</span>
<span class="s2">  &quot;&quot;&quot;</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">default_filename</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Make a default filename from the input file filename.</span>

<span class="sd">  Implements:</span>
<span class="sd">    if prefix is not None:</span>
<span class="sd">      return prefix + suffix</span>
<span class="sd">    else:</span>
<span class="sd">      return default</span>

<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    prefix: str or None</span>
<span class="sd">      The prefix used in determining the default filename.</span>

<span class="sd">    default: str</span>
<span class="sd">      Filename if input_filename is None</span>

<span class="sd">    suffix: str</span>
<span class="sd">      If input_filename is not None, append this suffix to the input_filename</span>
<span class="sd">      (excluding extension) to make the filename.</span>


<span class="sd">  Returns</span>
<span class="sd">  --------</span>

<span class="sd">    filename: str</span>
<span class="sd">      The generated default filename</span>

<span class="sd">  &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">suffix</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>


<div class="viewcode-block" id="set_input_defaults"><a class="viewcode-back" href="../../../reference/casm.learn.set_input_defaults.html#casm.learn.set_input_defaults">[docs]</a><span class="k">def</span> <span class="nf">set_input_defaults</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">input_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Set common input defaults. Currently, includes everything except &quot;checkspecs&quot;</span>
<span class="sd">  and &quot;checkhull&quot; defaults.</span>

<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    input: dict</span>
<span class="sd">      The input settings as a dict</span>

<span class="sd">    input_filename: str, optional, default=None</span>
<span class="sd">      The input settings filename, which is used in determining the default</span>
<span class="sd">      problem specs filename.</span>


<span class="sd">  Returns</span>
<span class="sd">  ---------</span>

<span class="sd">    input: dict</span>
<span class="sd">      The input settings as a dict, with defaults added</span>

<span class="sd">  &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;problem_specs&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">specs</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s2">&quot;problem_specs_prefix&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">input_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;problem_specs_prefix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;problem_specs_prefix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span>
                <span class="n">basename</span><span class="p">(</span><span class="n">input_filename</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="s2">&quot;specs_filename&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
        <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;specs_filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_filename</span><span class="p">(</span>
            <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;problem_specs_prefix&quot;</span><span class="p">],</span> <span class="s2">&quot;problem_specs.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;_specs.pkl&quot;</span><span class="p">)</span>

    <span class="c1"># set data defaults if not provided</span>
    <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
        <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
        <span class="s2">&quot;filetype&quot;</span><span class="p">:</span> <span class="s2">&quot;selection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="s2">&quot;corr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="s2">&quot;formation_energy&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">defaults</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
            <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">if</span> <span class="s2">&quot;kwargs&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;filetype&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;selection&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;project_path&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]:</span>
            <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;project_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># set weight defaults if not provided</span>
    <span class="n">sample_weight</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;weight&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
        <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;kwargs&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;method&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]:</span>
        <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;wHullDist&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;hull_selection&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]:</span>
            <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;hull_selection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CALCULATED&quot;</span>

    <span class="c1"># set cv defaults</span>
    <span class="k">if</span> <span class="s2">&quot;kwargs&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;penalty&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]:</span>
        <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;penalty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># set estimator defaults</span>
    <span class="k">if</span> <span class="s2">&quot;method&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">]:</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LinearRegression&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;kwargs&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">[</span>
            <span class="s2">&quot;estimator&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;fit_intercept&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]:</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;fit_intercept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># set feature_selection defaults</span>
    <span class="k">if</span> <span class="s2">&quot;kwargs&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">input</span><span class="p">[</span>
            <span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;evolve_params_kwargs&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">evolve_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;evolve_params_kwargs&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;halloffame_filename&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">evolve_kwargs</span><span class="p">:</span>
            <span class="n">evolve_kwargs</span><span class="p">[</span><span class="s2">&quot;halloffame_filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;evolve_halloffame.pkl&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;n_halloffame&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">evolve_kwargs</span><span class="p">:</span>
            <span class="n">evolve_kwargs</span><span class="p">[</span><span class="s2">&quot;n_halloffame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="k">if</span> <span class="s2">&quot;filename_prefix&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">evolve_kwargs</span> <span class="ow">and</span> <span class="n">input_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">evolve_kwargs</span><span class="p">[</span><span class="s2">&quot;filename_prefix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;problem_specs_prefix&quot;</span><span class="p">]</span>

    <span class="c1"># hall of fame</span>
    <span class="k">if</span> <span class="s2">&quot;halloffame_filename&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;halloffame_filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_filename</span><span class="p">(</span>
            <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;problem_specs_prefix&quot;</span><span class="p">],</span> <span class="s2">&quot;halloffame.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;_halloffame.pkl&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;n_halloffame&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;n_halloffame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>

    <span class="k">return</span> <span class="nb">input</span></div>


<div class="viewcode-block" id="open_input"><a class="viewcode-back" href="../../../reference/casm.learn.open_input.html#casm.learn.open_input">[docs]</a><span class="k">def</span> <span class="nf">open_input</span><span class="p">(</span><span class="n">input_filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Read casm-learn input file into a dict</span>

<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    input_filename: str</span>
<span class="sd">      The path to the input file</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">    input: dict</span>
<span class="sd">      The result of reading the input file and running it through</span>
<span class="sd">      casm.learn.set_input_defaults</span>
<span class="sd">  &quot;&quot;&quot;</span>
    <span class="c1"># open input and always set input defaults before doing anything else</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="n">set_input_defaults</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)),</span>
                                       <span class="n">input_filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error parsing JSON in&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">raise</span> <span class="n">e</span>
    <span class="k">return</span> <span class="nb">input</span></div>


<div class="viewcode-block" id="FittingData"><a class="viewcode-back" href="../../../reference/casm.learn.FittingData.html#casm.learn.FittingData">[docs]</a><span class="k">class</span> <span class="nc">FittingData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  FittingData holds feature values, target values, sample weights, etc. used</span>
<span class="sd">  to solve:</span>

<span class="sd">    L*X * b = L*y</span>

<span class="sd">  a weighted linear model where the weights are given by W = L * L.transpose().</span>

<span class="sd">  Attributes</span>
<span class="sd">  ----------</span>

<span class="sd">    X: array-like of shape (n_samples, n_features)</span>
<span class="sd">      The training input samples (correlations).</span>

<span class="sd">    y: array-like of shape: (n_samples, 1)</span>
<span class="sd">      The target values (property values).</span>

<span class="sd">    cv: cross-validation generator or an iterable</span>
<span class="sd">      Provides train/test splits</span>

<span class="sd">    n_samples: int</span>
<span class="sd">      The number of samples / target values (number of rows in X)</span>

<span class="sd">    n_features: int</span>
<span class="sd">      The number of features (number of columns in X)</span>

<span class="sd">    W: array-like of shape: (n_samples, n_samples)</span>
<span class="sd">      Contains sample weights.</span>

<span class="sd">    L: array-like of shape: (n_samples, n_samples)</span>
<span class="sd">      Used to generate weighted_X and weighted_y, W = L * L.transpose().</span>

<span class="sd">    weighted_X: array-like of shape: (n_samples, n_features)</span>
<span class="sd">      Weighted training input data, weighted_X = L*x.</span>

<span class="sd">    weighted_y: array-like of shape: (n_samples, 1)</span>
<span class="sd">      Weighted target values, weighted_y = L*y.</span>

<span class="sd">    scoring: string, callable or None, optional, default: None</span>
<span class="sd">      A string or a scorer callable object / function with signature</span>
<span class="sd">      scorer(estimator, X, y). The parameter for sklearn.model_selection.cross_val_score,</span>
<span class="sd">      default = None, uses estimator.score().</span>

<span class="sd">    penalty: float, optional, default=0.0</span>
<span class="sd">      The CV score is increased by &#39;penalty*(number of selected basis function)&#39;</span>

<span class="sd">    data: pandas.DataFrame, optional, default=None</span>
<span class="sd">        Optionally, store TrainingData.data with weighted_X and weighted_y data</span>
<span class="sd">        added. No checks are made for consistency of tdata.X, tdata.y and X and</span>
<span class="sd">        y or other parameters.</span>

<span class="sd">  &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FittingData.__init__"><a class="viewcode-back" href="../../../reference/casm.learn.FittingData.html#casm.learn.FittingData.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">X</span><span class="p">,</span>
                 <span class="n">y</span><span class="p">,</span>
                 <span class="n">cv</span><span class="p">,</span>
                 <span class="n">sample_weight</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">scoring</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">penalty</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">tdata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>

<span class="sd">      X: array-like of shape (n_samples, n_features)</span>
<span class="sd">        The training input samples (correlations).</span>

<span class="sd">      y: array-like of shape: (n_samples, 1)</span>
<span class="sd">        The target values (property values).</span>

<span class="sd">      cv: cross-validation generator or an iterable</span>
<span class="sd">        Provides train/test splits</span>

<span class="sd">      sample_weight: None, 1-d array-like of shape: (n_samples, 1), or 2-d array-like of shape: (n_samples, n_samples)</span>
<span class="sd">        Sample weights.</span>

<span class="sd">        if sample_weight is None: (default, unweighted)</span>
<span class="sd">          W = np.matlib.eye(N)</span>
<span class="sd">        if sample_weight is 1-dimensional:</span>
<span class="sd">          W = np.diag(sample_weight)*Nvalue/np.sum(sample_weight)</span>
<span class="sd">        if sample_weight is 2-dimensional (must be Hermitian, positive-definite):</span>
<span class="sd">          W = sample_weight*Nvalue/np.sum(sample_weight)</span>

<span class="sd">      scoring: string, callable or None, optional, default=None</span>
<span class="sd">        A string or a scorer callable object / function with signature</span>
<span class="sd">        scorer(estimator, X, y). The parameter for sklearn.model_selection.cross_val_score,</span>
<span class="sd">        default = None, uses estimator.score().</span>

<span class="sd">      penalty: float, optional, default=0.0</span>
<span class="sd">        The CV score is increased by &#39;penalty*(number of selected basis function)&#39;</span>

<span class="sd">      tdata: TrainingData instance, optional, default=None</span>
<span class="sd">        Optionally, store TrainingData.data with weighted_X and weighted_y data</span>
<span class="sd">        added. No checks are made for consistency of tdata.X, tdata.y and X and</span>
<span class="sd">        y or other parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

        <span class="c1"># Number of configurations and basis functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_weight</span> <span class="o">=</span> <span class="n">sample_weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weighted_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighted_X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">set_sample_weight</span><span class="p">(</span>
            <span class="n">sample_weight</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># cv sets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">cv</span>

        <span class="c1"># scoring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="n">scoring</span>

        <span class="c1"># penalty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">penalty</span> <span class="o">=</span> <span class="n">penalty</span>

        <span class="c1"># data</span>
        <span class="k">if</span> <span class="n">tdata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">tdata</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;weighted_&quot;</span> <span class="o">+</span> <span class="n">tdata</span><span class="o">.</span><span class="n">X_name</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span>
                              <span class="s2">&quot;)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighted_X</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;weighted_&quot;</span> <span class="o">+</span> <span class="n">tdata</span><span class="o">.</span><span class="n">y_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weighted_y</span></div></div>


<div class="viewcode-block" id="TrainingData"><a class="viewcode-back" href="../../../reference/casm.learn.TrainingData.html#casm.learn.TrainingData">[docs]</a><span class="k">class</span> <span class="nc">TrainingData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  TrainingData is a data structure used to collect data from the training</span>
<span class="sd">  data file.</span>


<span class="sd">  Attributes</span>
<span class="sd">  ----------</span>

<span class="sd">    filename: str</span>
<span class="sd">      The name of the training data file</span>

<span class="sd">    filetype: str, one of [&quot;selection&quot;, &quot;csv&quot;, &quot;json&quot;]</span>
<span class="sd">      The data format of the training data file</span>

<span class="sd">    X_name: str</span>
<span class="sd">      The name of the X columns in the training data file</span>

<span class="sd">    X: array-like of shape (n_samples, n_features)</span>
<span class="sd">      The training input samples (correlations).</span>

<span class="sd">    y_name: str</span>
<span class="sd">      The name of the y column in the training data file</span>

<span class="sd">    y: array-like of shape: (n_samples, 1)</span>
<span class="sd">      The target values (property values).</span>

<span class="sd">    n_samples: int</span>
<span class="sd">      The number of samples / target values (number of rows in X)</span>

<span class="sd">    n_features: int</span>
<span class="sd">      The number of features (number of columns in X)</span>

<span class="sd">    sel: casm.Selection, (exists if filetype==&quot;selection&quot;)</span>
<span class="sd">      The selection specifying the training data</span>

<span class="sd">    data: pandas.DataFrame</span>
<span class="sd">      Contains the X and y data</span>

<span class="sd">    hull_dist_name: str, (exists if weight method==&quot;wHullDist&quot;)</span>
<span class="sd">      The name of the hull_dist column in the training data file</span>

<span class="sd">    hull_dist: array-like of shape: (n_samples, 1), (exists if weight method==&quot;wHullDist&quot;)</span>
<span class="sd">      The hull distance values.</span>


<span class="sd">  &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TrainingData.__init__"><a class="viewcode-back" href="../../../reference/casm.learn.TrainingData.html#casm.learn.TrainingData.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>

<span class="sd">      input: dict</span>
<span class="sd">        The input settings as a dict</span>

<span class="sd">      verbose: boolean, optional, default=True</span>
<span class="sd">        Print information to stdout.</span>

<span class="sd">    &quot;&quot;&quot;</span>
        <span class="n">specs</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span> <span class="o">=</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;filetype&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_name</span> <span class="o">=</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;X&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_name</span> <span class="o">=</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="n">hull_dist_name</span> <span class="o">=</span> <span class="s2">&quot;hull_dist&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span> <span class="o">==</span> <span class="s2">&quot;selection&quot;</span><span class="p">:</span>

            <span class="c1"># read training set</span>
            <span class="n">proj</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;project_path&quot;</span><span class="p">],</span>
                           <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

            <span class="n">sel</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># get property name (required)</span>
            <span class="nb">property</span> <span class="o">=</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

            <span class="c1">## if necessary, query data</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y_name</span><span class="p">,</span> <span class="s2">&quot;is_calculated&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sel</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">([</span>
                    <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sel</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_name</span> <span class="o">+</span> <span class="s2">&quot;\([0-9]*\)&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;wHullDist&quot;</span><span class="p">:</span>
                <span class="n">hull_selection</span> <span class="o">=</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;hull_selection&quot;</span><span class="p">]</span>
                <span class="n">hull_dist_name</span> <span class="o">=</span> <span class="s2">&quot;hull_dist(&quot;</span> <span class="o">+</span> <span class="n">hull_selection</span> <span class="o">+</span> <span class="s2">&quot;,atom_frac)&quot;</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# wHullDist: Will calculate hull distance:&quot;</span><span class="p">,</span>
                          <span class="n">hull_dist_name</span><span class="p">)</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hull_dist_name</span><span class="p">)</span>

            <span class="c1"># perform query</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
                <span class="n">sel</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sel</span> <span class="o">=</span> <span class="n">sel</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
            <span class="c1"># populate from csv file</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">])</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="c1"># populate from json file</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">])</span>

        <span class="c1"># columns of interest, as numpy arrays</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_name</span> <span class="o">+</span> <span class="s2">&quot;\([0-9]*\)&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="p">]]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;wHullDist&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hull_dist_name</span> <span class="o">=</span> <span class="n">hull_dist_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hull_dist</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">hull_dist_name</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div></div>


<span class="k">def</span> <span class="nf">read_sample_weight</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">tdata</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Read input file and read or calculate sample weights</span>

<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    input: dict</span>
<span class="sd">      The input settings as a dict</span>

<span class="sd">    tdata: TrainingData instance</span>
<span class="sd">      tdata.data is populated with a &quot;weight&quot; column, or the &quot;weight&quot; column</span>
<span class="sd">      is used to generate &quot;sample_weight&quot; output, depending on the weight method</span>

<span class="sd">    verbose: boolean, optional, default=True</span>
<span class="sd">      Print information to stdout.</span>


<span class="sd">  Returns</span>
<span class="sd">  ---------</span>

<span class="sd">    sample_weight: None, 1d array-like of shape (n_samples,1), or 2d array-like of shape (n_samples, n_samples)</span>
<span class="sd">      Sample weights.</span>

<span class="sd">      if sample_weight is None: (unweighted)</span>
<span class="sd">        W = np.matlib.eye(N)</span>
<span class="sd">      if sample_weight is 1-dimensional:</span>
<span class="sd">        W = np.diag(sample_weight)*Nvalue/np.sum(sample_weight)</span>
<span class="sd">      if sample_weight is 2-dimensional (must be Hermitian, positive-definite):</span>
<span class="sd">        W = sample_weight*Nvalue/np.sum(sample_weight)</span>
<span class="sd">  &quot;&quot;&quot;</span>

    <span class="n">specs</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Weighting:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># get kwargs</span>
    <span class="n">weight_kwargs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">])</span>

    <span class="c1"># use method to get weights</span>
    <span class="k">if</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;wCustom&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Reading custom weights&quot;</span><span class="p">)</span>
        <span class="n">sample_weight</span> <span class="o">=</span> <span class="n">tdata</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">elif</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;wCustom2d&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Reading custom2d weights&quot;</span><span class="p">)</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;weight(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tdata</span><span class="o">.</span><span class="n">n_samples</span><span class="p">)]</span>
        <span class="n">sample_weight</span> <span class="o">=</span> <span class="n">tdata</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">elif</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;wHullDist&quot;</span><span class="p">:</span>
        <span class="n">sample_weight</span> <span class="o">=</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">wHullDist</span><span class="p">(</span><span class="n">tdata</span><span class="o">.</span><span class="n">hull_dist</span><span class="p">,</span>
                                                   <span class="o">**</span><span class="n">weight_kwargs</span><span class="p">)</span>
        <span class="n">tdata</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_weight</span>
    <span class="k">elif</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;wEmin&quot;</span><span class="p">:</span>
        <span class="n">sample_weight</span> <span class="o">=</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">wEmin</span><span class="p">(</span><span class="n">tdata</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">weight_kwargs</span><span class="p">)</span>
        <span class="n">tdata</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_weight</span>
    <span class="k">elif</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;wEref&quot;</span><span class="p">:</span>
        <span class="n">sample_weight</span> <span class="o">=</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">wEref</span><span class="p">(</span><span class="n">tdata</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">weight_kwargs</span><span class="p">)</span>
        <span class="n">tdata</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_weight</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sample_weight</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sample_weight</span>


<span class="k">def</span> <span class="nf">make_fitting_data</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">read_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Construct a FittingData instance, either by reading existing &#39;fit_data.pkl&#39;,</span>
<span class="sd">  or from an input settings.</span>

<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    input: dict</span>
<span class="sd">      The input settings as a dict</span>

<span class="sd">    save: boolean, optional, default=True</span>
<span class="sd">      Save a pickle file containing the training data and scoring metric. The file</span>
<span class="sd">      name is specified by input[&quot;problem_specs&quot;][&quot;specs_filename&quot;].  See/use</span>
<span class="sd">      set_input_defaults for default values.</span>

<span class="sd">    verbose: boolean, optional, default=True</span>
<span class="sd">      Print information to stdout.</span>

<span class="sd">    read_existing: boolean, optional, default=True</span>
<span class="sd">      If it exists, read the pickle file containing the training data and scoring</span>
<span class="sd">      metric. The file name, which can be specified by input[&quot;fit_data_filename&quot;],</span>
<span class="sd">      defaults to &quot;fit_data.pkl&quot;.</span>


<span class="sd">  Returns</span>
<span class="sd">  -------</span>

<span class="sd">    fdata: casm.learn.FittingData</span>
<span class="sd">      A FittingData instance constructed based on the input parameters.</span>

<span class="sd">  &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Get problem data...&quot;</span><span class="p">)</span>

    <span class="n">specs</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span>

    <span class="c1"># property, weight, and cv inputs should remain constant</span>
    <span class="c1"># estimator and feature_selection might change</span>
    <span class="n">fit_data_filename</span> <span class="o">=</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;specs_filename&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">read_existing</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fit_data_filename</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Reading existing problem specs from:&quot;</span><span class="p">,</span> <span class="n">fit_data_filename</span><span class="p">)</span>
        <span class="n">fdata</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fit_data_filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#   DONE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Problem specifications have changed.</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;To proceed with the existing specs adjust your input settings </span><span class="se">\&quot;</span><span class="s2">problem_specs</span><span class="se">\&quot;</span><span class="s2"> to match.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
            <span class="s2">&quot;To proceed with the new specs run in a new directory or delete &#39;&quot;</span> <span class="o">+</span> <span class="n">fit_data_filename</span> <span class="o">+</span> <span class="s2">&quot;&#39;.&quot;</span>

        <span class="k">def</span> <span class="nf">check_input</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fdata</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">!=</span> <span class="n">specs</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Input file and stored data differ. Input &#39;&quot;</span> <span class="o">+</span>
                      <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;&#39; has changed.&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Stored data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                      <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">specs</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;cv&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]:</span>
            <span class="n">check_input</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="c1">## get data ####</span>

        <span class="n">tdata</span> <span class="o">=</span> <span class="n">TrainingData</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Target:&quot;</span><span class="p">,</span> <span class="n">tdata</span><span class="o">.</span><span class="n">y_name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Training samples:&quot;</span><span class="p">,</span> <span class="n">tdata</span><span class="o">.</span><span class="n">n_samples</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Features:&quot;</span><span class="p">,</span> <span class="n">tdata</span><span class="o">.</span><span class="n">n_features</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1">## weight (optional)</span>
        <span class="n">sample_weight</span> <span class="o">=</span> <span class="n">read_sample_weight</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">tdata</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1">## cv</span>
        <span class="n">cv_kwargs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">])</span>

        <span class="c1"># get cv method (required user input)</span>
        <span class="n">cv_method</span> <span class="o">=</span> <span class="n">_find_method</span><span class="p">(</span>
            <span class="p">[</span><span class="n">sklearn</span><span class="o">.</span><span class="n">model_selection</span><span class="p">,</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">model_selection</span><span class="p">],</span>
            <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">])</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">cv_method</span><span class="p">(</span><span class="o">**</span><span class="n">cv_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# CV:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1">## scoring</span>
        <span class="n">scoring</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">make_scorer</span><span class="p">(</span>
            <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">## penalty</span>
        <span class="n">penalty</span> <span class="o">=</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span><span class="s2">&quot;penalty&quot;</span><span class="p">]</span>

        <span class="n">fdata</span> <span class="o">=</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">FittingData</span><span class="p">(</span><span class="n">tdata</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
                                       <span class="n">tdata</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                       <span class="n">cv</span><span class="p">,</span>
                                       <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">,</span>
                                       <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span>
                                       <span class="n">penalty</span><span class="o">=</span><span class="n">penalty</span><span class="p">,</span>
                                       <span class="n">tdata</span><span class="o">=</span><span class="n">tdata</span><span class="p">)</span>

        <span class="n">fdata</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">fdata</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specs</span>

        <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fit_data_filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">fdata</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Writing problem specs to:&quot;</span><span class="p">,</span> <span class="n">fit_data_filename</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;# To inspect or customize the problem specs further, use the &#39;--checkspecs&#39; method</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="c1"># during runtime only, if LinearRegression and LeaveOneOut, update fdata.cv and fdata.scoring</span>
    <span class="c1"># to use optimized LOOCV score method</span>
    <span class="k">if</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LinearRegression&quot;</span> <span class="ow">and</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">][</span>
            <span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LeaveOneOut&quot;</span><span class="p">:</span>
        <span class="n">fdata</span><span class="o">.</span><span class="n">scoring</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">fdata</span><span class="o">.</span><span class="n">cv</span> <span class="o">=</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">LeaveOneOutForLLS</span><span class="p">(</span>
            <span class="n">fdata</span><span class="o">.</span><span class="n">weighted_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">fdata</span>


<span class="k">def</span> <span class="nf">make_estimator</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Construct estimator object from input settings.</span>

<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    input: dict</span>
<span class="sd">      The input settings as a dict</span>

<span class="sd">    verbose: boolean, optional, default=True</span>
<span class="sd">      Print information to stdout.</span>


<span class="sd">  Returns</span>
<span class="sd">  -------</span>

<span class="sd">    estimator:  estimator object implementing &#39;fit&#39;</span>
<span class="sd">      The estimator specified by the input settings.</span>

<span class="sd">  &quot;&quot;&quot;</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Estimator:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1">## estimator</span>

    <span class="c1"># get kwargs (default: fit_intercept=False)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">])</span>

    <span class="c1"># Use casm version of LinearRegression</span>
    <span class="k">if</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LinearRegression&quot;</span><span class="p">:</span>
        <span class="n">estimator_method</span> <span class="o">=</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegressionForLOOCV</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">estimator_method</span> <span class="o">=</span> <span class="n">_find_method</span><span class="p">([</span><span class="n">sklearn</span><span class="o">.</span><span class="n">linear_model</span><span class="p">],</span>
                                        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">])</span>
    <span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator_method</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">estimator</span>


<span class="k">def</span> <span class="nf">make_selector</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span>
                  <span class="n">estimator</span><span class="p">,</span>
                  <span class="n">scoring</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">cv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">penalty</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Construct selector object from input settings</span>

<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    estimator:  estimator object implementing &#39;fit&#39;</span>
<span class="sd">      The estimator specified by the input settings.</span>

<span class="sd">    scoring: string, callable or None, optional, default: None</span>
<span class="sd">      A string or a scorer callable object / function with signature</span>
<span class="sd">      scorer(estimator, X, y). The parameter for sklearn.model_selection.cross_val_score,</span>
<span class="sd">      default = None, uses estimator.score().</span>

<span class="sd">    cv: cross-validation generator or an iterable</span>
<span class="sd">      Provides train/test splits</span>

<span class="sd">    penalty: float, optional, default=0.0</span>
<span class="sd">      The CV score is increased by &#39;penalty*(number of selected basis function)&#39;</span>

<span class="sd">    verbose: boolean, optional, default=True</span>
<span class="sd">      Print information to stdout.</span>


<span class="sd">  Returns</span>
<span class="sd">  -------</span>

<span class="sd">    selector:  selector object implementing &#39;fit&#39; and having either a</span>
<span class="sd">               &#39;get_support()&#39; or &#39;get_halloffame()&#39; member</span>
<span class="sd">      The feature selector specified by the input settings.</span>

<span class="sd">  &quot;&quot;&quot;</span>

    <span class="c1"># read input, construct and return a feature selector</span>
    <span class="c1">#</span>
    <span class="c1"># The feature selector should act like a sklearn.feature_selection class and</span>
    <span class="c1"># inherit from sklearn.base.BaseEstimator and sklearn.feature_selection.SelectorMixin,</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Feature Selection:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">mods</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">feature_selection</span><span class="p">,</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">feature_selection</span><span class="p">,</span>
        <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">selection_wrapper</span>
    <span class="p">]</span>

    <span class="n">selector_method</span> <span class="o">=</span> <span class="n">_find_method</span><span class="p">(</span><span class="n">mods</span><span class="p">,</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;feature_selection&quot;</span><span class="p">][</span><span class="s2">&quot;method&quot;</span><span class="p">])</span>

    <span class="c1"># check if &#39;cv&#39;, &#39;scoring&#39;, &#39;penalty&#39; are allowed kwargs</span>

    <span class="c1">#  arg_count = selector_method.__init__.func_code.co_argcount</span>
    <span class="c1">#  allowed_kwargs = selector_method.__init__.func_code.co_varnames[:arg_count]</span>

    <span class="c1">#  print(&quot;allowed_kwargs:&quot;, str(allowed_kwargs))</span>

    <span class="c1">#  if &quot;cv&quot; in allowed_kwargs:</span>
    <span class="c1">#    kwargs[&quot;cv&quot;] = cv</span>
    <span class="c1">#  if &quot;scoring&quot; in allowed_kwargs:</span>
    <span class="c1">#    kwargs[&quot;scoring&quot;] = scoring</span>
    <span class="c1">#  if &quot;penalty&quot; in allowed_kwargs:</span>
    <span class="c1">#    kwargs[&quot;penalty&quot;] = penalty</span>
    <span class="c1">#  if &quot;verbose&quot; in allowed_kwargs:</span>
    <span class="c1">#    kwargs[&quot;verbose&quot;] = verbose</span>

    <span class="n">sig</span> <span class="o">=</span> <span class="n">signature</span><span class="p">(</span><span class="n">selector_method</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
    <span class="c1">#  print(&quot;sig.parameters.keys():&quot;, str(sig.parameters.keys()))</span>

    <span class="k">if</span> <span class="s2">&quot;cv&quot;</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv</span>
    <span class="k">if</span> <span class="s2">&quot;scoring&quot;</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scoring&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scoring</span>
    <span class="k">if</span> <span class="s2">&quot;penalty&quot;</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;penalty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">penalty</span>
    <span class="k">if</span> <span class="s2">&quot;verbose&quot;</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="n">selector</span> <span class="o">=</span> <span class="n">selector_method</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">selector</span>


<span class="k">def</span> <span class="nf">add_individual_detail</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">fdata</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Adds attributes to an individual describing the details of the method used</span>
<span class="sd">  calculate it and the it&#39;s prediction ability.</span>

<span class="sd">  Adds the attributes:</span>

<span class="sd">    eci: List[(int, float)]</span>
<span class="sd">      A list of tuple containing the basis function index and coefficient value</span>
<span class="sd">      for basis functions with non-zero coefficients: [(index, coef), ...]</span>

<span class="sd">    rms: float</span>
<span class="sd">      The root mean square prediction error of the unweighted problem</span>

<span class="sd">    wrms: float</span>
<span class="sd">      The root mean square prediction error of the weighted problem</span>

<span class="sd">    mean_absolute_error: float</span>
<span class="sd">      The mean absolute prediction error of the unweighted problem</span>

<span class="sd">    wmean_absolute_error: float</span>
<span class="sd">      The mean absolute prediction error of the weighted problem</span>

<span class="sd">    max_absolute_error: float</span>
<span class="sd">      The maximum absolute prediction error of the unweighted problem</span>

<span class="sd">    wmax_absolute_error: float</span>
<span class="sd">      The maximum absolute prediction error of the weighted problem</span>

<span class="sd">    estimator_method: string</span>
<span class="sd">      The estimator method class name</span>

<span class="sd">    feature_selection_method: string,</span>
<span class="sd">      The feature_selection method class name</span>

<span class="sd">    note: string</span>
<span class="sd">      Additional notes describing the individual</span>

<span class="sd">    input: dict</span>
<span class="sd">      The input settings</span>

<span class="sd">    id: uuid.UUID</span>
<span class="sd">      Unique id, generated by uuid.uuid4()</span>


<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    indiv: List[bool] of length n_features</span>
<span class="sd">      This is a boolean list of shape [n_features], in which an element is True</span>
<span class="sd">      iff its corresponding feature is selected for retention.</span>

<span class="sd">    estimator:  estimator object implementing &#39;fit&#39;</span>
<span class="sd">      The estimator specified by the input settings.</span>

<span class="sd">    fdata: casm.learn.FittingData</span>
<span class="sd">      A FittingData instance containing the problem data.</span>

<span class="sd">    input: dict</span>
<span class="sd">      The input settings</span>

<span class="sd">    selector:  selector object implementing &#39;fit&#39; and having either a</span>
<span class="sd">               &#39;get_support()&#39; or &#39;get_halloffame()&#39; member, optional, default=None</span>
<span class="sd">      The feature selector specified by the input settings.</span>


<span class="sd">  Note</span>
<span class="sd">  ----</span>
<span class="sd">    Individuals should already have a &#39;fitness.values&#39; attribute with the cv</span>
<span class="sd">    score. As is the convention in the &#39;deap&#39; package, the &#39;fitness.values&#39;</span>
<span class="sd">    attribute is a tuple with the first element being the cv score.</span>

<span class="sd">  &quot;&quot;&quot;</span>
    <span class="c1"># eci</span>
    <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">weighted_X</span><span class="p">[:,</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">indiv</span><span class="p">)],</span>
                  <span class="n">fdata</span><span class="o">.</span><span class="n">weighted_y</span><span class="p">)</span>
    <span class="n">indiv</span><span class="o">.</span><span class="n">eci</span> <span class="o">=</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">eci</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="n">estimator</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>

    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">indiv</span><span class="p">)])</span>
    <span class="n">weighted_y_pred</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
        <span class="n">fdata</span><span class="o">.</span><span class="n">weighted_X</span><span class="p">[:,</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">indiv</span><span class="p">)])</span>

    <span class="c1"># rms and wrms</span>
    <span class="n">indiv</span><span class="o">.</span><span class="n">rms</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="n">indiv</span><span class="o">.</span><span class="n">wrms</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span>
        <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">weighted_y</span><span class="p">,</span> <span class="n">weighted_y_pred</span><span class="p">))</span>

    <span class="c1"># mean_absolute_error</span>
    <span class="n">indiv</span><span class="o">.</span><span class="n">mean_absolute_error</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span>
        <span class="n">fdata</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">indiv</span><span class="o">.</span><span class="n">wmean_absolute_error</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span>
        <span class="n">fdata</span><span class="o">.</span><span class="n">weighted_y</span><span class="p">,</span> <span class="n">weighted_y_pred</span><span class="p">)</span>

    <span class="c1"># max_absolute_error</span>
    <span class="n">indiv</span><span class="o">.</span><span class="n">max_absolute_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">indiv</span><span class="o">.</span><span class="n">wmax_absolute_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">weighted_y</span> <span class="o">-</span>
                                            <span class="n">weighted_y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="c1"># estimator (hide implementation detail)</span>
    <span class="n">indiv</span><span class="o">.</span><span class="n">estimator_method</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">estimator</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">if</span> <span class="n">indiv</span><span class="o">.</span><span class="n">estimator_method</span> <span class="o">==</span> <span class="s2">&quot;LinearRegressionForLOOCV&quot;</span><span class="p">:</span>
        <span class="n">indiv</span><span class="o">.</span><span class="n">estimator_method</span> <span class="o">=</span> <span class="s2">&quot;LinearRegression&quot;</span>

    <span class="c1"># feature_selection</span>
    <span class="k">if</span> <span class="n">selector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indiv</span><span class="o">.</span><span class="n">feature_selection_method</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="s2">&quot;feature_selection_method&quot;</span><span class="p">):</span>
        <span class="n">indiv</span><span class="o">.</span><span class="n">feature_selection_method</span> <span class="o">=</span> <span class="s2">&quot;DirectSelection&quot;</span>

    <span class="c1"># note</span>
    <span class="n">indiv</span><span class="o">.</span><span class="n">note</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># input settings</span>
    <span class="n">indiv</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="nb">input</span>

    <span class="c1"># unique id</span>
    <span class="n">indiv</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">indiv</span>


<div class="viewcode-block" id="checkhull"><a class="viewcode-back" href="../../../reference/casm.learn.checkhull.html#casm.learn.checkhull">[docs]</a><span class="k">def</span> <span class="nf">checkhull</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">hall</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Check for hull properties and add pandas.DataFrame attributes to each individual:</span>

<span class="sd">    &quot;dft_gs&quot; : DFT calculated ground states</span>
<span class="sd">    &quot;clex_gs&quot; : predicted ground states</span>
<span class="sd">    &quot;gs_missing&quot; : DFT ground states that are not predicted ground states</span>
<span class="sd">    &quot;gs_spurious&quot; : Predicted ground states that are not DFT ground states</span>
<span class="sd">    &quot;uncalculated&quot; : Predicted ground states and near ground states that have not been calculated</span>
<span class="sd">    &quot;below_hull&quot; : All configurations predicted below the prediction of the DFT hull</span>
<span class="sd">    &quot;ranged_rms&quot;: root-mean-square error calculated for the subset of configurations</span>
<span class="sd">      whose DFT formation energy lies within some range of the DFT convex hull.</span>
<span class="sd">      Currently calculated for ranges 0.001, 0.005, 0.01, 0.05, 0.1, 0.5 eV/unit cell</span>

<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    input: dict</span>
<span class="sd">      The input settings as a dict. This is expected to have the object</span>
<span class="sd">      input[&quot;checkspecs&quot;], with the following attributes:</span>

<span class="sd">        selection: str, optional, default=&quot;ALL&quot;</span>
<span class="sd">          A CASM selection (either &#39;casm select&#39; output filename or one of the</span>
<span class="sd">          standard selection &quot;MASTER&quot;, &quot;CALCULATED&quot;, or &quot;ALL&quot;) containing all the</span>
<span class="sd">          configurations to be considered. The DFT convex hull is generated from</span>
<span class="sd">          the subset of this selection for which &#39;is_calculated&#39; is true.</span>

<span class="sd">        write_results: bool, optional, default=False</span>
<span class="sd">          If True, write casm selection files containing the output data. Output</span>
<span class="sd">          selection files are named &quot;checkhull_(problem_specs_prefix)_(i)_(selname)&quot;,</span>
<span class="sd">          where &#39;problem_specs_prefix&#39; is input[&quot;problem_specs_prefix&quot;], &#39;i&#39; is the</span>
<span class="sd">          index of the individual in the hall of fame, and &#39;selname&#39; is one of:</span>
<span class="sd">            &quot;dft_gs&quot; : DFT calculated ground states</span>
<span class="sd">            &quot;clex_gs&quot; : predicted ground states</span>
<span class="sd">            &quot;gs_missing&quot; : DFT ground states that are not predicted ground states</span>
<span class="sd">            &quot;gs_spurious&quot; : Predicted ground states that are not DFT ground states</span>
<span class="sd">            &quot;uncalculated&quot; : Predicted ground states and near ground states that have not been calculated</span>
<span class="sd">            &quot;below_hull&quot; : All configurations predicted below the prediction of the DFT hull</span>

<span class="sd">        primitive_only: bool, optional, default=True</span>
<span class="sd">          If True, only use primitive configurations to construct the convex hull,</span>
<span class="sd">          else use all selected configurations.</span>

<span class="sd">        uncalculated_range: number, optional, default=0.0</span>
<span class="sd">          Include all configurations with clex_hull_dist less than this value (+hull_tol)</span>
<span class="sd">          in the &quot;uncalculated&quot; configurations. Default only includes predicted</span>
<span class="sd">          ground states.</span>

<span class="sd">        ranged_rms: List[number], optional, default=[0.001, 0.005, 0.01, 0.05, 0.1, 0.5]</span>
<span class="sd">          Calculates the root-mean-square error for DFT calculated configurations</span>
<span class="sd">          within a particular range (in eV/unitcell) of the DFT hull. The list</span>
<span class="sd">          provides all the ranges for which the RMSE is requested.</span>

<span class="sd">        composition: str, optional, default=&quot;atom_frac&quot;</span>
<span class="sd">          Composition argument use for &#39;casm query&#39; properties &#39;hull_dist&#39; and</span>
<span class="sd">          &#39;clex_hull_dist&#39;. For thermodynamic ground states, use &quot;atom_frac&quot;.</span>

<span class="sd">        hull_tol: number, optional, default=proj.settings.data[&quot;lin_alg_tol&quot;]</span>
<span class="sd">          Tolerance used for identify hull states</span>

<span class="sd">        dim_tol: number, optional, default=1e-8</span>
<span class="sd">          Tolerance for detecting composition dimensionality</span>

<span class="sd">        bottom_tol: number, optional, default=1e-8</span>
<span class="sd">          Tolerance for detecting which facets form the convex hull bottom</span>


<span class="sd">        Example:</span>

<span class="sd">          &quot;checkhull&quot; : {</span>
<span class="sd">            &quot;selection&quot;: &quot;ALL&quot;,</span>
<span class="sd">            &quot;write_results&quot;: True</span>
<span class="sd">            &quot;primitive_only&quot;: true,</span>
<span class="sd">            &quot;uncalculated_range&quot;: 0.0,</span>
<span class="sd">            &quot;ranged_rms&quot;: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5],</span>
<span class="sd">            &quot;composition&quot;: &quot;atom_frac&quot;,</span>
<span class="sd">            &quot;hull_tol&quot;: 1e-8,</span>
<span class="sd">            &quot;dim_tol&quot;: 1e-8,</span>
<span class="sd">            &quot;bottom_tol&quot;: 1e-8,</span>
<span class="sd">          }</span>


<span class="sd">    hall: deap.tools.HallOfFame, optional, default=None</span>
<span class="sd">      A Hall Of Fame containing individuals to check convex hull properties</span>

<span class="sd">    selection: str</span>
<span class="sd">      The name of the selection to use for calculating the convex hull</span>

<span class="sd">    write_results: bool, optional, default=True</span>


<span class="sd">    indices: List[int], optional, default=None</span>
<span class="sd">      If given, only check hull properties for specified individuals in the hall</span>
<span class="sd">      of fame.</span>

<span class="sd">    verbose: boolean, optional, default=True</span>
<span class="sd">      Print information to stdout.</span>


<span class="sd">  &quot;&quot;&quot;</span>

    <span class="c1"># set checkhull default settings</span>
    <span class="k">if</span> <span class="s2">&quot;checkhull&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkhull&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">opt</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;selection&quot;</span><span class="p">:</span> <span class="s2">&quot;ALL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;write_results&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;primitive_only&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;uncalculated_range&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;hull_tol&quot;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">,</span>
        <span class="s2">&quot;composition&quot;</span><span class="p">:</span> <span class="s2">&quot;atom_frac&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dim_tol&quot;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">,</span>
        <span class="s2">&quot;bottom_tol&quot;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">,</span>
        <span class="s2">&quot;ranged_rms&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">opt</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkhull&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkhull&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkhull&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="c1"># construct FittingData (to check consistency with input file)</span>
    <span class="n">fdata</span> <span class="o">=</span> <span class="n">make_fitting_data</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span>
                              <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                              <span class="n">read_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># open Project to work on</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;project_path&quot;</span><span class="p">],</span>
                   <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1"># tolerance for finding configurations &#39;on_hull&#39;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkhull&quot;</span><span class="p">]</span>
    <span class="n">selection</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;selection&quot;</span><span class="p">]</span>
    <span class="n">composition</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;composition&quot;</span><span class="p">]</span>
    <span class="n">write_results</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;write_results&quot;</span><span class="p">]</span>
    <span class="n">hull_tol</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;hull_tol&quot;</span><span class="p">]</span>
    <span class="n">uncalculated_range</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;uncalculated_range&quot;</span><span class="p">]</span>
    <span class="n">dim_tol</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;dim_tol&quot;</span><span class="p">]</span>
    <span class="n">bottom_tol</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;bottom_tol&quot;</span><span class="p">]</span>
    <span class="n">primitive_only</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;primitive_only&quot;</span><span class="p">]</span>

    <span class="c1"># save current default clex</span>
    <span class="n">orig_clex</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">default_clex</span>
    <span class="n">clex</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">orig_clex</span><span class="p">)</span>
    <span class="n">all_eci</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">all_eci</span><span class="p">(</span><span class="n">clex</span><span class="o">.</span><span class="n">property</span><span class="p">,</span> <span class="n">clex</span><span class="o">.</span><span class="n">calctype</span><span class="p">,</span> <span class="n">clex</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span>
                               <span class="n">clex</span><span class="o">.</span><span class="n">bset</span><span class="p">)</span>

    <span class="c1"># not sure of all the edge cases, enforcing these seems simpler for now...</span>
    <span class="k">if</span> <span class="n">clex</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;formation_energy&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;default clex:&quot;</span><span class="p">,</span> <span class="n">clex</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;use &#39;casm settings --set-default-clex formation_energy&#39; to change the default clex&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s2">&quot;Error using checkhull: default clex must be &#39;formation_energy&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;formation_energy&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;property:&quot;</span><span class="p">,</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">])</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s2">&quot;Error using checkhull: property must be &#39;formation_energy&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># load hull selection</span>
    <span class="n">sel</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">selection</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># create a temporary file containing the subset of the selection that is calculated</span>
    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">proj</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">casm_dir</span><span class="p">(),</span> <span class="s2">&quot;tmp&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>
    <span class="n">dft_selection</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">selection</span> <span class="o">+</span> <span class="s2">&quot;_dft&quot;</span><span class="p">)</span>
    <span class="n">dft_hull_selection</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">selection</span> <span class="o">+</span> <span class="s2">&quot;_dft_hull&quot;</span><span class="p">)</span>
    <span class="n">proj</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="s2">&quot;select -c &quot;</span> <span class="o">+</span> <span class="n">selection</span> <span class="o">+</span>
                 <span class="s2">&quot; --set-off &#39;not(is_calculated)&#39; -f -o &quot;</span> <span class="o">+</span> <span class="n">dft_selection</span><span class="p">)</span>

    <span class="c1"># properties to query</span>
    <span class="n">selected</span> <span class="o">=</span> <span class="s2">&quot;selected&quot;</span>
    <span class="n">is_primitive</span> <span class="o">=</span> <span class="s2">&quot;is_primitive&quot;</span>
    <span class="n">is_calculated</span> <span class="o">=</span> <span class="s2">&quot;is_calculated&quot;</span>
    <span class="n">configname</span> <span class="o">=</span> <span class="s2">&quot;configname&quot;</span>
    <span class="n">dft_hull_dist_long</span> <span class="o">=</span> <span class="s2">&quot;hull_dist(&quot;</span> <span class="o">+</span> <span class="n">dft_selection</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="n">composition</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
    <span class="n">dft_hull_dist</span> <span class="o">=</span> <span class="s2">&quot;dft_hull_dist&quot;</span>
    <span class="n">clex_hull_dist_long</span> <span class="o">=</span> <span class="s2">&quot;clex_hull_dist(&quot;</span> <span class="o">+</span> <span class="n">selection</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="n">composition</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
    <span class="n">clex_hull_dist</span> <span class="o">=</span> <span class="s2">&quot;clex_hull_dist&quot;</span>
    <span class="n">clex_dft_hull_dist_long</span> <span class="o">=</span> <span class="s2">&quot;clex_hull_dist(&quot;</span> <span class="o">+</span> <span class="n">dft_hull_selection</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="n">composition</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
    <span class="n">clex_dft_hull_dist</span> <span class="o">=</span> <span class="s2">&quot;clex_dft_hull_dist&quot;</span>
    <span class="n">comp</span> <span class="o">=</span> <span class="s2">&quot;comp&quot;</span>
    <span class="n">dft_Eform</span> <span class="o">=</span> <span class="s2">&quot;formation_energy&quot;</span>
    <span class="n">clex_Eform</span> <span class="o">=</span> <span class="s2">&quot;clex(formation_energy)&quot;</span>

    <span class="n">query_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">comp</span><span class="p">,</span> <span class="n">is_calculated</span><span class="p">,</span> <span class="n">configname</span><span class="p">,</span> <span class="n">dft_hull_dist_long</span><span class="p">,</span> <span class="n">dft_Eform</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">primitive_only</span><span class="p">:</span>
        <span class="n">query_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">is_primitive</span><span class="p">)</span>
    <span class="n">sel</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_cols</span><span class="p">)</span>

    <span class="n">compcol</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">sel</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">col</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;comp(&quot;</span><span class="p">:</span>
            <span class="n">compcol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">compcol</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hall</span><span class="p">))</span>

    <span class="c1"># write eci.json</span>
    <span class="n">eci</span> <span class="o">=</span> <span class="s2">&quot;__tmp&quot;</span>
    <span class="n">clex</span><span class="o">.</span><span class="n">eci</span> <span class="o">=</span> <span class="n">eci</span>
    <span class="k">if</span> <span class="n">eci</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_eci</span><span class="p">:</span>
        <span class="n">proj</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="s2">&quot;settings --new-eci &quot;</span> <span class="o">+</span> <span class="n">eci</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">proj</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="s2">&quot;settings --set-eci &quot;</span> <span class="o">+</span> <span class="n">eci</span><span class="p">)</span>

    <span class="c1"># for each individual specified...</span>
    <span class="k">for</span> <span class="n">indiv_i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-- Check: individual&quot;</span><span class="p">,</span> <span class="n">indiv_i</span><span class="p">,</span> <span class="s2">&quot; --&quot;</span><span class="p">)</span>
            <span class="n">print_individual</span><span class="p">(</span><span class="n">hall</span><span class="p">,</span> <span class="p">[</span><span class="n">indiv_i</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># write ECI to use</span>
        <span class="n">indiv</span> <span class="o">=</span> <span class="n">hall</span><span class="p">[</span><span class="n">indiv_i</span><span class="p">]</span>
        <span class="n">write_eci</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span>
                  <span class="n">indiv</span><span class="o">.</span><span class="n">eci</span><span class="p">,</span>
                  <span class="n">fit_details</span><span class="o">=</span><span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">indiv_i</span><span class="p">,</span> <span class="n">indiv</span><span class="p">),</span>
                  <span class="n">clex</span><span class="o">=</span><span class="n">clex</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">primitive_only</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sel</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span>
                                       <span class="n">is_primitive</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">compcol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">compcol</span><span class="p">)</span>
        <span class="n">df_calc</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">is_calculated</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span>
                                                          <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="n">dft_gs</span> <span class="o">=</span> <span class="n">df_calc</span><span class="p">[</span><span class="n">df_calc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">dft_hull_dist_long</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">hull_tol</span><span class="p">]</span>

        <span class="c1"># create dft hull selection</span>
        <span class="n">dft_hull_sel</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">dft_hull_selection</span><span class="p">)</span>
        <span class="n">dft_hull_sel</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dft_gs</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># query:</span>
        <span class="n">sel</span><span class="o">.</span><span class="n">query</span><span class="p">([</span><span class="n">clex_hull_dist_long</span><span class="p">,</span> <span class="n">clex_Eform</span><span class="p">,</span> <span class="n">clex_dft_hull_dist_long</span><span class="p">],</span>
                  <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">primitive_only</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sel</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span>
                                       <span class="n">is_primitive</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">compcol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">compcol</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
                      <span class="n">dft_hull_dist_long</span><span class="p">:</span> <span class="n">dft_hull_dist</span><span class="p">,</span>
                      <span class="n">clex_hull_dist_long</span><span class="p">:</span> <span class="n">clex_hull_dist</span><span class="p">,</span>
                      <span class="n">clex_dft_hull_dist_long</span><span class="p">:</span> <span class="n">clex_dft_hull_dist</span>
                  <span class="p">})</span>
        <span class="n">df_calc</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">is_calculated</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span>
                                                          <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="n">clex_gs</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">clex_hull_dist</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">hull_tol</span><span class="p">]</span>
        <span class="n">dft_gs</span> <span class="o">=</span> <span class="n">df_calc</span><span class="p">[</span><span class="n">df_calc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">dft_hull_dist</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">hull_tol</span><span class="p">]</span>

        <span class="n">uncalculated</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">clex_hull_dist</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">uncalculated_range</span> <span class="o">+</span>
                           <span class="n">hull_tol</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">is_calculated</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">gs_spurious</span> <span class="o">=</span> <span class="n">df_calc</span><span class="p">[(</span><span class="n">df_calc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">clex_hull_dist</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">hull_tol</span><span class="p">)</span>
                              <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">df_calc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">dft_hull_dist</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">hull_tol</span><span class="p">)]</span>
        <span class="n">gs_missing</span> <span class="o">=</span> <span class="n">df_calc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df_calc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">clex_hull_dist</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">hull_tol</span><span class="p">)</span>
                             <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_calc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">dft_hull_dist</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">hull_tol</span><span class="p">)]</span>
        <span class="n">below_hull</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">clex_dft_hull_dist</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">hull_tol</span><span class="p">]</span>

        <span class="n">indiv</span><span class="o">.</span><span class="n">clex_gs</span> <span class="o">=</span> <span class="n">clex_gs</span>
        <span class="n">indiv</span><span class="o">.</span><span class="n">dft_gs</span> <span class="o">=</span> <span class="n">dft_gs</span>
        <span class="n">indiv</span><span class="o">.</span><span class="n">uncalculated</span> <span class="o">=</span> <span class="n">uncalculated</span>
        <span class="n">indiv</span><span class="o">.</span><span class="n">gs_spurious</span> <span class="o">=</span> <span class="n">gs_spurious</span>
        <span class="n">indiv</span><span class="o">.</span><span class="n">gs_missing</span> <span class="o">=</span> <span class="n">gs_missing</span>
        <span class="n">indiv</span><span class="o">.</span><span class="n">below_hull</span> <span class="o">=</span> <span class="n">below_hull</span>

        <span class="n">to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="n">selected</span><span class="p">,</span> <span class="n">is_primitive</span><span class="p">,</span> <span class="n">is_calculated</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">printer</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">][</span><span class="s2">&quot;problem_specs_prefix&quot;</span><span class="p">]</span>
            <span class="n">output_name</span> <span class="o">=</span> <span class="s2">&quot;checkhull&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">output_name</span> <span class="o">+=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">prefix</span>
            <span class="n">output_name</span> <span class="o">+=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indiv_i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">attr</span>

            <span class="n">df</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">title</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">to_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">write_results</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;write:&quot;</span><span class="p">,</span> <span class="n">output_name</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">write_results</span><span class="p">:</span>
                    <span class="n">output_sel</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">output_name</span><span class="p">)</span>
                    <span class="n">output_sel</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;dft_gs&quot;</span><span class="p">,</span> <span class="s2">&quot;DFT ground states&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;clex_gs&quot;</span><span class="p">,</span> <span class="s2">&quot;Predicted ground states&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;gs_missing&quot;</span><span class="p">,</span>
                <span class="s2">&quot;DFT ground states that are not predicted ground states&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span><span class="s2">&quot;gs_spurious&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Predicted ground states that are not DFT ground states&quot;</span><span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span>
            <span class="s2">&quot;uncalculated&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Predicted ground states and near ground states that have not been calculated&quot;</span>
        <span class="p">)</span>
        <span class="n">printer</span><span class="p">(</span>
            <span class="s2">&quot;below_hull&quot;</span><span class="p">,</span>
            <span class="s2">&quot;All configurations predicted below the prediction of the DFT hull&quot;</span>
        <span class="p">)</span>

        <span class="c1"># calculated ranged rms</span>
        <span class="k">def</span> <span class="nf">calc_ranged_rms</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
            <span class="n">ranged_df</span> <span class="o">=</span> <span class="n">df_calc</span><span class="p">[</span><span class="n">df_calc</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">dft_hull_dist</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">r</span> <span class="o">+</span>
                                <span class="n">hull_tol</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">ranged_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ranged_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span>
                          <span class="s2">&quot;diff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ranged_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span>
                                                  <span class="n">dft_Eform</span><span class="p">]</span> <span class="o">-</span> <span class="n">ranged_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span>
                                                                             <span class="n">clex_Eform</span><span class="p">]</span>
            <span class="n">ranged_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span>
                          <span class="s2">&quot;diff_sqr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ranged_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span>
                                                      <span class="s2">&quot;diff&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ranged_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span>
                                                                              <span class="s2">&quot;diff&quot;</span><span class="p">]</span>
            <span class="n">rms</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span>
                <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span>
                    <span class="n">ranged_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">dft_Eform</span><span class="p">],</span> <span class="n">ranged_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">clex_Eform</span><span class="p">]))</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">rms</span><span class="p">)</span>

        <span class="n">ranged_rms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkhull&quot;</span><span class="p">][</span><span class="s2">&quot;ranged_rms&quot;</span><span class="p">]:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">calc_ranged_rms</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="n">ranged_rms</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="n">r</span><span class="p">,</span> <span class="s2">&quot;n_config&quot;</span><span class="p">:</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;rms&quot;</span><span class="p">:</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
        <span class="n">ranged_rms</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n_config&quot;</span><span class="p">:</span> <span class="n">df_calc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;rms&quot;</span><span class="p">:</span> <span class="n">indiv</span><span class="o">.</span><span class="n">rms</span>
        <span class="p">})</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ranged_rms:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ranged_rms</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  RMS error for&quot;</span><span class="p">,</span>
                      <span class="n">d</span><span class="p">[</span><span class="s2">&quot;n_config&quot;</span><span class="p">],</span>
                      <span class="s2">&quot;calculated configurations within&quot;</span><span class="p">,</span>
                      <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;range&quot;</span><span class="p">],</span> <span class="s2">&quot;eV/unitcell of the DFT hull:&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;rms&quot;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">sel</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">clex_dft_hull_dist_long</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">indiv</span><span class="o">.</span><span class="n">ranged_rms</span> <span class="o">=</span> <span class="n">ranged_rms</span>
        <span class="n">indiv</span><span class="o">.</span><span class="n">checkhull_settings</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkhull&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># reset eci setting</span>
    <span class="n">proj</span><span class="o">.</span><span class="n">capture</span><span class="p">(</span><span class="s2">&quot;settings --set-eci &quot;</span> <span class="o">+</span> <span class="n">orig_clex</span><span class="o">.</span><span class="n">eci</span><span class="p">)</span>

    <span class="c1"># remove __tmp eci and tmp selections</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">proj</span><span class="o">.</span><span class="n">dir</span><span class="o">.</span><span class="n">eci_dir</span><span class="p">(</span><span class="n">clex</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dft_selection</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dft_hull_selection</span><span class="p">)</span></div>


<div class="viewcode-block" id="checkspecs"><a class="viewcode-back" href="../../../reference/casm.learn.checkspecs.html#casm.learn.checkspecs">[docs]</a><span class="k">def</span> <span class="nf">checkspecs</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Output data and cv files containing the current problem specs.</span>

<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    input: dict</span>
<span class="sd">      The input settings as a dict. This is expected to have the object</span>
<span class="sd">      input[&quot;checkspecs&quot;], with the following attributes:</span>

<span class="sd">        data_filename: string</span>
<span class="sd">          The path to the file where the training data (including weights) should be</span>
<span class="sd">          written</span>

<span class="sd">        data_kwargs: dict or null, optional, default=dict()</span>
<span class="sd">          Additional parameters to be used to write training data.</span>

<span class="sd">          Options for input &#39;filetype&#39; &quot;selection&quot;:</span>
<span class="sd">            None.</span>

<span class="sd">          Options for input &#39;filetype&#39; &quot;csv&quot;:</span>
<span class="sd">            Any options to pass to pandas.to_csv</span>

<span class="sd">          Options for input &#39;filetype&#39; &quot;json&quot;:</span>
<span class="sd">            Any options to pass to pandas.to_json</span>

<span class="sd">        cv_filename: string</span>
<span class="sd">          The path to the file where the cv generator or train/tests sets should be</span>
<span class="sd">          written as pickle file</span>

<span class="sd">        cv_kwargs: dict or null, optional, default=dict()</span>
<span class="sd">          Additional parameters to be used to write cv data using pickle.dump.</span>

<span class="sd">        Example:</span>

<span class="sd">          &quot;checkspecs&quot; : {</span>
<span class="sd">            &quot;data_filename&quot;: &quot;check_train&quot;,</span>
<span class="sd">            &quot;data_kwargs&quot;: null,</span>
<span class="sd">            &quot;cv_filename&quot;: &quot;check_cv.pkl&quot;,</span>
<span class="sd">            &quot;cv_kwargs&quot;: null</span>
<span class="sd">          }</span>

<span class="sd">    verbose: boolean, optional, default=True</span>
<span class="sd">      Print information to stdout.</span>

<span class="sd">  &quot;&quot;&quot;</span>
    <span class="n">specs</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span>

    <span class="c1"># set checkspecs default settings</span>
    <span class="k">if</span> <span class="s2">&quot;checkspecs&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;data_filename&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">]:</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;_data&quot;</span> <span class="o">+</span> <span class="n">splitext</span><span class="p">(</span><span class="n">basename</span><span class="p">(</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">]))[</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">][</span><span class="s2">&quot;data_filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_filename</span><span class="p">(</span>
            <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;problem_specs_prefix&quot;</span><span class="p">],</span> <span class="s2">&quot;check_data&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;data_kwargs&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">[</span>
            <span class="s2">&quot;checkspecs&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">][</span><span class="s2">&quot;data_kwargs&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">][</span><span class="s2">&quot;data_kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;cv_filename&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">]:</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">][</span><span class="s2">&quot;cv_filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_filename</span><span class="p">(</span>
            <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;problem_specs_prefix&quot;</span><span class="p">],</span> <span class="s2">&quot;check_cv.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;_cv.pkl&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;cv_kwargs&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">[</span>
            <span class="s2">&quot;checkspecs&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">][</span><span class="s2">&quot;cv_kwargs&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">][</span><span class="s2">&quot;cv_kwargs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">specs</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;problem_specs&quot;</span><span class="p">]</span>

    <span class="c1"># construct or load problem specs</span>
    <span class="n">fdata</span> <span class="o">=</span> <span class="n">casm</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">make_fitting_data</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span>
                                             <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                             <span class="n">read_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Check problem specs:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># print training data</span>
    <span class="n">filetype</span> <span class="o">=</span> <span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;filetype&quot;</span><span class="p">]</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">][</span><span class="s2">&quot;data_filename&quot;</span><span class="p">]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">][</span><span class="s2">&quot;data_kwargs&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s2">&quot;selection&quot;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">specs</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;kwargs&quot;</span><span class="p">][</span><span class="s2">&quot;project_path&quot;</span><span class="p">],</span>
                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">Selection</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">sel</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">fdata</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
        <span class="n">fdata</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="n">fdata</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Wrote training data (including weights) to:&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="c1"># print cv</span>
    <span class="n">cv_filename</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">][</span><span class="s2">&quot;cv_filename&quot;</span><span class="p">]</span>
    <span class="n">cv_kwargs</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s2">&quot;checkspecs&quot;</span><span class="p">][</span><span class="s2">&quot;cv_kwargs&quot;</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cv_filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">fdata</span><span class="o">.</span><span class="n">cv</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# Wrote CV data to:&quot;</span><span class="p">,</span> <span class="n">cv_filename</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">bitstr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="n">n_bits_max</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n_bits_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">n_bits_max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indiv</span><span class="p">)</span>
    <span class="n">bitstr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indiv</span><span class="p">),</span> <span class="n">n_bits_max</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">indiv</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">bitstr</span> <span class="o">+=</span> <span class="s1">&#39;1&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bitstr</span> <span class="o">+=</span> <span class="s1">&#39;0&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indiv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">n_bits_max</span><span class="p">:</span>
        <span class="n">bitstr</span> <span class="o">+=</span> <span class="s2">&quot;...&quot;</span>
    <span class="k">return</span> <span class="n">bitstr</span>


<div class="viewcode-block" id="print_population"><a class="viewcode-back" href="../../../reference/casm.learn.print_population.html#casm.learn.print_population">[docs]</a><span class="k">def</span> <span class="nf">print_population</span><span class="p">(</span><span class="n">pop</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Print all individual in a population.</span>

<span class="sd">  Example:</span>

<span class="sd">    Index: Selected                                    #Selected    CV</span>
<span class="sd">    ----------------------------------------------------------------------------------------------------</span>
<span class="sd">        0: 0111011110000111000001001100000100010000... 25           0.015609282</span>
<span class="sd">        1: 0111011110000111000001001101000100010000... 25           0.015611913</span>
<span class="sd">        2: 0111011110000111000001001100000100010000... 24           0.015619745</span>
<span class="sd">    ...</span>


<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    pop: List-like of List[bool] of length n_features</span>
<span class="sd">      A population, a list-like container of individuals. Each individual is a</span>
<span class="sd">      boolean list of shape [n_features], in which an element is True iff its</span>
<span class="sd">      corresponding feature is selected for retention.</span>
<span class="sd">  &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:5}</span><span class="s2">: </span><span class="si">{1:43}</span><span class="s2"> </span><span class="si">{2:&lt;12}</span><span class="s2"> </span><span class="si">{3:&lt;12}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Index&quot;</span><span class="p">,</span> <span class="s2">&quot;Selected&quot;</span><span class="p">,</span>
                                                 <span class="s2">&quot;#Selected&quot;</span><span class="p">,</span> <span class="s2">&quot;CV&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">form_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:5}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2:&lt;12}</span><span class="s2"> </span><span class="si">{3:&lt;12.8g}</span><span class="s2">&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="n">form_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">bitstr</span><span class="p">(</span><span class="n">pop</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">40</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pop</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                            <span class="n">pop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>


<div class="viewcode-block" id="to_json"><a class="viewcode-back" href="../../../reference/casm.learn.to_json.html#casm.learn.to_json">[docs]</a><span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">indiv</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Serialize an individual to JSON records.</span>

<span class="sd">  Keys in each record:</span>
<span class="sd">    &quot;index&quot;: index of individual in hall of fame</span>
<span class="sd">    &quot;id&quot;: uuid str for individual</span>
<span class="sd">    &quot;selected&quot;: str of 0&#39;s and 1&#39;s indicating selected features</span>
<span class="sd">    &quot;n_selected&quot;: number of selected features</span>
<span class="sd">    &quot;cv&quot;: CV score</span>
<span class="sd">    &quot;rms&quot;: root-mean-square error</span>
<span class="sd">    &quot;wrms&quot;: weighted problem root-mean-square error</span>
<span class="sd">    &quot;mean_absolute_error&quot;: mean absolute error</span>
<span class="sd">    &quot;wmean_absolute_error&quot;: weighted problem mean absolute error</span>
<span class="sd">    &quot;max_absolute_error&quot;: maximum absolute error</span>
<span class="sd">    &quot;wmax_absolute_error&quot;: weighted problem maximum absolute error</span>
<span class="sd">    &quot;estimator_method&quot;: name of estimator method</span>
<span class="sd">    &quot;features_selection_method&quot;: name of feature selection method</span>
<span class="sd">    &quot;note&quot;: a descriptive note</span>
<span class="sd">    &quot;eci&quot;: List of (feature index, coefficient value) pairs</span>
<span class="sd">    &quot;input&quot;: input settings dict</span>

<span class="sd">  Keys added by --checkhull, if y=&quot;formation_energy&quot;: pandas.DataFrame</span>
<span class="sd">    &quot;dft_gs&quot; : DFT calculated ground states</span>
<span class="sd">    &quot;clex_gs&quot; : predicted ground states</span>
<span class="sd">    &quot;gs_missing&quot; : DFT ground states that are not predicted ground states</span>
<span class="sd">    &quot;gs_spurious&quot; : Predicted ground states that are not DFT ground states</span>
<span class="sd">    &quot;uncalculated&quot; : Predicted ground states and near ground states that have not been calculated</span>
<span class="sd">    &quot;below_hull&quot; : All configurations predicted below the prediction of the DFT hull</span>
<span class="sd">    &quot;ranged_rms&quot;: root-mean-square error calculated for the subset of configurations</span>
<span class="sd">      whose DFT formation energy lies within some range of the DFT convex hull</span>


<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    index: int</span>
<span class="sd">      The index in hall of fame of the individual</span>

<span class="sd">    indiv: List[bool] of length n_features</span>
<span class="sd">      This is a boolean list of shape [n_features], in which an element is True</span>
<span class="sd">      iff its corresponding feature is selected for retention.</span>


<span class="sd">  Note</span>
<span class="sd">  ----</span>

<span class="sd">    ECI are serialized using cls=casm.misc.noident.noindent.NoIndent, so when writing with json.dump or</span>
<span class="sd">    json.dumps, include &#39;cls=casm.misc.noindent.noindent.NoIndentEncoder&#39;.</span>

<span class="sd">  &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">indiv</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;selected&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bitstr</span><span class="p">(</span><span class="n">indiv</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;n_selected&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">indiv</span><span class="p">))</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;cv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indiv</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">attr</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;rms&quot;</span><span class="p">,</span> <span class="s2">&quot;wrms&quot;</span><span class="p">,</span> <span class="s2">&quot;ranged_rms&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">,</span>
        <span class="s2">&quot;wmean_absolute_error&quot;</span><span class="p">,</span> <span class="s2">&quot;max_absolute_error&quot;</span><span class="p">,</span> <span class="s2">&quot;wmax_absolute_error&quot;</span><span class="p">,</span>
        <span class="s2">&quot;estimator_method&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_selection_method&quot;</span><span class="p">,</span> <span class="s2">&quot;note&quot;</span><span class="p">,</span>
        <span class="s2">&quot;checkhull_settings&quot;</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attr</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
            <span class="n">d</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;clex_gs&quot;</span><span class="p">,</span> <span class="s2">&quot;dft_gs&quot;</span><span class="p">,</span> <span class="s2">&quot;uncalculated&quot;</span><span class="p">,</span> <span class="s2">&quot;gs_spurious&quot;</span><span class="p">,</span> <span class="s2">&quot;gs_missing&quot;</span><span class="p">,</span>
            <span class="s2">&quot;below_hull&quot;</span>
    <span class="p">]:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
            <span class="n">d</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">))</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;eci&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">bfunc</span> <span class="ow">in</span> <span class="n">indiv</span><span class="o">.</span><span class="n">eci</span><span class="p">:</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;eci&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">noindent</span><span class="o">.</span><span class="n">NoIndent</span><span class="p">(</span><span class="n">bfunc</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">d</span></div>


<span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">hall</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Convert hall of fame data to pandas.DataFrame.</span>

<span class="sd">  Columns:</span>
<span class="sd">    &quot;index&quot;: index of individual in hall of fame</span>
<span class="sd">    &quot;id&quot;: uuid str for individual</span>
<span class="sd">    &quot;selected&quot;: str of 0&#39;s and 1&#39;s indicating selected features</span>
<span class="sd">    &quot;n_selected&quot;: number of selected features</span>
<span class="sd">    &quot;cv&quot;: CV score</span>
<span class="sd">    &quot;rms&quot;: root-mean-square error</span>
<span class="sd">    &quot;wrms&quot;: weighted root-mean-square error</span>
<span class="sd">    &quot;mean_absolute_error&quot;: mean absolute error</span>
<span class="sd">    &quot;wmean_absolute_error&quot;: weighted problem mean absolute error</span>
<span class="sd">    &quot;max_absolute_error&quot;: maximum absolute error</span>
<span class="sd">    &quot;wmax_absolute_error&quot;: weighted problem maximum absolute error</span>
<span class="sd">    &quot;estimator_method&quot;: name of estimator method</span>
<span class="sd">    &quot;features_selection_method&quot;: name of feature selection method</span>
<span class="sd">    &quot;note&quot;: a descriptive note</span>
<span class="sd">    &quot;eci&quot;: JSON string of a List of (feature index, coefficient value) pairs</span>
<span class="sd">    &quot;input&quot;: input settings dict</span>

<span class="sd">  Keys added by --checkhull, if y=&quot;formation_energy&quot;: pandas.DataFrame</span>
<span class="sd">    &quot;dft_gs&quot; : DFT calculated ground states</span>
<span class="sd">    &quot;clex_gs&quot; : predicted ground states</span>
<span class="sd">    &quot;gs_missing&quot; : DFT ground states that are not predicted ground states</span>
<span class="sd">    &quot;gs_spurious&quot; : Predicted ground states that are not DFT ground states</span>
<span class="sd">    &quot;uncalculated&quot; : Predicted ground states and near ground states that have not been calculated</span>
<span class="sd">    &quot;below_hull&quot; : All configurations predicted below the prediction of the DFT hull</span>
<span class="sd">    &quot;ranged_rms&quot;: root-mean-square error calculated for the subset of configurations</span>
<span class="sd">      whose DFT formation energy lies within some range of the DFT convex hull</span>


<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    indices: List[int]</span>
<span class="sd">      The indices in hall of fame of the individuals to include</span>

<span class="sd">    hall: deap.tools.HallOfFame</span>
<span class="sd">      A Hall Of Fame of ECI sets</span>

<span class="sd">  &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_json</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">hall</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;eci&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;eci&quot;</span><span class="p">],</span> <span class="bp">cls</span><span class="o">=</span><span class="n">noindent</span><span class="o">.</span><span class="n">NoIndentEncoder</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_print_individual</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">indiv</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Print all individual in hall of fame.</span>

<span class="sd">  Index: Selected                                    #Selected    CV          wRMS</span>
<span class="sd">  ----------------------------------------------------------------------------------------------------</span>
<span class="sd">      0: 0111011110000111000001001100000100010000... 25           0.015609282  0.014073401</span>
<span class="sd">      1: 0111011110000111000001001101000100010000... 25           0.015611913  0.014045382</span>
<span class="sd">      2: 0111011110000111000001001100000100010000... 24           0.015619745  0.01411583</span>
<span class="sd">  ...</span>
<span class="sd">  &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indiv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">:</span>
            <span class="n">bitstr_len</span> <span class="o">=</span> <span class="mi">43</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bitstr_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indiv</span><span class="p">)</span>
        <span class="n">form_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:5}</span><span class="s2">: {1:&lt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span>
            <span class="mi">12</span><span class="p">,</span> <span class="n">bitstr_len</span>
        <span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;} </span><span class="si">{2:&lt;12}</span><span class="s2"> </span><span class="si">{3:&lt;12.8g}</span><span class="s2"> </span><span class="si">{4:&lt;12.8g}</span><span class="s2"> </span><span class="si">{5:&lt;12.8g}</span><span class="s2"> </span><span class="si">{6:&lt;24}</span><span class="s2"> </span><span class="si">{7:&lt;24}</span><span class="s2"> </span><span class="si">{8}</span><span class="s2">&quot;</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="n">form_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">bitstr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">indiv</span><span class="p">),</span>
                            <span class="n">indiv</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indiv</span><span class="o">.</span><span class="n">rms</span><span class="p">,</span> <span class="n">indiv</span><span class="o">.</span><span class="n">wrms</span><span class="p">,</span>
                            <span class="n">indiv</span><span class="o">.</span><span class="n">estimator_method</span><span class="p">,</span>
                            <span class="n">indiv</span><span class="o">.</span><span class="n">feature_selection_method</span><span class="p">,</span> <span class="n">indiv</span><span class="o">.</span><span class="n">note</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="k">elif</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">to_json</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">indiv</span><span class="p">),</span>
                       <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                       <span class="bp">cls</span><span class="o">=</span><span class="n">noindent</span><span class="o">.</span><span class="n">NoIndentEncoder</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="k">elif</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;details&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;##&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Index:&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ID:&quot;</span><span class="p">,</span> <span class="n">indiv</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected:&quot;</span><span class="p">,</span> <span class="n">bitstr</span><span class="p">(</span><span class="n">indiv</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#Selected:&quot;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">indiv</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CV:&quot;</span><span class="p">,</span> <span class="n">indiv</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">attr</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;rms&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wrms&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wmean_absolute_error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max_absolute_error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wmax_absolute_error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;estimator_method&quot;</span><span class="p">,</span>
            <span class="s2">&quot;feature_selection_method&quot;</span><span class="p">,</span>
            <span class="s2">&quot;note&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attr</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="s2">&quot;ranged_rms&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ranged_rms:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">indiv</span><span class="o">.</span><span class="n">ranged_rms</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;eci:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">print_eci</span><span class="p">(</span><span class="n">indiv</span><span class="o">.</span><span class="n">eci</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;clex_gs&quot;</span><span class="p">,</span> <span class="s2">&quot;dft_gs&quot;</span><span class="p">,</span> <span class="s2">&quot;uncalculated&quot;</span><span class="p">,</span> <span class="s2">&quot;gs_spurious&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gs_missing&quot;</span><span class="p">,</span> <span class="s2">&quot;below_hull&quot;</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">attr</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">indiv</span><span class="o">.</span><span class="n">input</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="s2">&quot;checkhull_settings&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checkhull settings:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                  <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">indiv</span><span class="o">.</span><span class="n">checkhull_settings</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span>


<span class="k">def</span> <span class="nf">_print_halloffame_header</span><span class="p">(</span><span class="n">hall</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Print header for hall of fame.</span>
<span class="sd">  &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hall</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">:</span>
        <span class="n">bitstr_len</span> <span class="o">=</span> <span class="mi">43</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bitstr_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hall</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">{0:5}</span><span class="s2">: {1:&lt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="mi">12</span><span class="p">,</span> <span class="n">bitstr_len</span><span class="p">]))</span> <span class="o">+</span>
           <span class="s2">&quot;} </span><span class="si">{2:&lt;12}</span><span class="s2"> </span><span class="si">{3:&lt;12}</span><span class="s2"> </span><span class="si">{4:&lt;12}</span><span class="s2"> </span><span class="si">{5:&lt;12}</span><span class="s2"> </span><span class="si">{6:&lt;24}</span><span class="s2"> </span><span class="si">{7:&lt;24}</span><span class="s2"> </span><span class="si">{8}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
               <span class="s2">&quot;Index&quot;</span><span class="p">,</span> <span class="s2">&quot;Selected&quot;</span><span class="p">,</span> <span class="s2">&quot;#Selected&quot;</span><span class="p">,</span> <span class="s2">&quot;CV&quot;</span><span class="p">,</span> <span class="s2">&quot;RMS&quot;</span><span class="p">,</span> <span class="s2">&quot;wRMS&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Estimator&quot;</span><span class="p">,</span> <span class="s2">&quot;FeatureSelection&quot;</span><span class="p">,</span> <span class="s2">&quot;Note&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">6</span> <span class="o">+</span> <span class="nb">max</span><span class="p">([</span><span class="mi">12</span><span class="p">,</span> <span class="n">bitstr_len</span><span class="p">])</span> <span class="o">+</span> <span class="mi">13</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">25</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>


<div class="viewcode-block" id="print_individual"><a class="viewcode-back" href="../../../reference/casm.learn.print_individual.html#casm.learn.print_individual">[docs]</a><span class="k">def</span> <span class="nf">print_individual</span><span class="p">(</span><span class="n">hall</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Print selected individuals from hall of fame.</span>

<span class="sd">  Arguments:</span>
<span class="sd">  ----------</span>

<span class="sd">    hall: deap.tools.HallOfFame</span>
<span class="sd">      A Hall Of Fame of ECI sets</span>

<span class="sd">    index: List[int]</span>
<span class="sd">      Indices of individual in hall to be printed</span>

<span class="sd">    format: str, optional, default=None</span>
<span class="sd">      Options:</span>
<span class="sd">        None:      to print summary only</span>
<span class="sd">        &quot;details&quot;: to print more</span>
<span class="sd">        &quot;csv&quot;:     to print as CSV</span>
<span class="sd">        &quot;json&quot;:    to print as JSON</span>
<span class="sd">  &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_print_halloffame_header</span><span class="p">(</span><span class="n">hall</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">_print_individual</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">hall</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">elif</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">to_json</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">hall</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">noindent</span><span class="o">.</span><span class="n">NoIndentEncoder</span><span class="p">))</span>

    <span class="k">elif</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">to_dataframe</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hall</span><span class="p">)),</span> <span class="n">hall</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">())</span>

    <span class="k">elif</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;details&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">_print_individual</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">hall</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="print_halloffame"><a class="viewcode-back" href="../../../reference/casm.learn.print_halloffame.html#casm.learn.print_halloffame">[docs]</a><span class="k">def</span> <span class="nf">print_halloffame</span><span class="p">(</span><span class="n">hall</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Print all individual in hall of fame.</span>

<span class="sd">  Arguments:</span>
<span class="sd">  ----------</span>

<span class="sd">    hall: deap.tools.HallOfFame</span>
<span class="sd">      A Hall Of Fame of ECI sets</span>

<span class="sd">    format: str, optional, default=None</span>
<span class="sd">      Options:</span>
<span class="sd">        None:      to print summary only</span>
<span class="sd">        &quot;details&quot;: to print more</span>
<span class="sd">        &quot;csv&quot;:     to print as CSV</span>
<span class="sd">        &quot;json&quot;:    to print as JSON</span>
<span class="sd">  &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_print_halloffame_header</span><span class="p">(</span><span class="n">hall</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">indiv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hall</span><span class="p">):</span>
            <span class="n">_print_individual</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">indiv</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>

        <span class="k">return</span>

    <span class="k">elif</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">indiv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hall</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">to_json</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">indiv</span><span class="p">)</span>
            <span class="n">h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">noindent</span><span class="o">.</span><span class="n">NoIndentEncoder</span><span class="p">))</span>

    <span class="k">elif</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">to_dataframe</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hall</span><span class="p">)),</span> <span class="n">hall</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">())</span>

    <span class="k">elif</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;details&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">indiv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hall</span><span class="p">):</span>
            <span class="n">_print_individual</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">indiv</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">return</span></div>


<div class="viewcode-block" id="print_eci"><a class="viewcode-back" href="../../../reference/casm.learn.print_eci.html#casm.learn.print_eci">[docs]</a><span class="k">def</span> <span class="nf">print_eci</span><span class="p">(</span><span class="n">eci</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Print ECI.</span>

<span class="sd">  Format:</span>
<span class="sd">      1: -1.53460558686</span>
<span class="sd">      2:  0.574571156376</span>
<span class="sd">      3:  1.04379783648</span>
<span class="sd">  ...</span>

<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    eci: List[(int, float)]</span>
<span class="sd">      A list of tuple containing the basis function index and coefficient value</span>
<span class="sd">      for basis functions with non-zero coefficients: [(index, coef), ...]</span>

<span class="sd">  &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">bfunc</span> <span class="ow">in</span> <span class="n">eci</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{index:&gt;5}</span><span class="s2">: </span><span class="si">{value:&lt; .12g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">bfunc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                  <span class="n">value</span><span class="o">=</span><span class="n">bfunc</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span></div>


<div class="viewcode-block" id="open_halloffame"><a class="viewcode-back" href="../../../reference/casm.learn.open_halloffame.html#casm.learn.open_halloffame">[docs]</a><span class="k">def</span> <span class="nf">open_halloffame</span><span class="p">(</span><span class="n">halloffame_filename</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Open hall of fame from .pkl file.</span>

<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    halloffame_filename: string</span>
<span class="sd">      Name of .pkl file containing the hall of fame</span>

<span class="sd">    verbose: boolean, optional, default=True</span>
<span class="sd">      Print information to stdout.</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>

<span class="sd">    hall: deap.tools.HallOfFame</span>
<span class="sd">      A Hall Of Fame of ECI sets</span>

<span class="sd">  &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loading Hall of Fame:&quot;</span><span class="p">,</span> <span class="n">halloffame_filename</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">halloffame_filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">hall</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># for backwards compatibility, add id if not existing</span>
    <span class="k">for</span> <span class="n">indiv</span> <span class="ow">in</span> <span class="n">hall</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">indiv</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">):</span>
            <span class="n">indiv</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">hall</span></div>


<div class="viewcode-block" id="save_halloffame"><a class="viewcode-back" href="../../../reference/casm.learn.save_halloffame.html#casm.learn.save_halloffame">[docs]</a><span class="k">def</span> <span class="nf">save_halloffame</span><span class="p">(</span><span class="n">hall</span><span class="p">,</span> <span class="n">halloffame_filename</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Save hall of fame as .pkl file.</span>

<span class="sd">  Arguments</span>
<span class="sd">  ---------</span>

<span class="sd">    hall: deap.tools.HallOfFame</span>
<span class="sd">      A Hall Of Fame of ECI sets</span>

<span class="sd">    halloffame_filename: string</span>
<span class="sd">      Name of .pkl file to write the hall of fame</span>

<span class="sd">    verbose: boolean, optional, default=True</span>
<span class="sd">      Print information to stdout.</span>

<span class="sd">  &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pickling Hall of Fame to:&quot;</span><span class="p">,</span> <span class="n">halloffame_filename</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">halloffame_filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">hall</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018, CASM Developers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>