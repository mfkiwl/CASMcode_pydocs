

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>casm.quantumespresso.qeio.infile &mdash; CASM 0.3.dev documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../../../about.html" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> CASM
          

          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../python/index.html">CASM Python packages documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../about.html">About CASM</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">CASM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>casm.quantumespresso.qeio.infile</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for casm.quantumespresso.qeio.infile</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="k">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span><span class="nn">copy</span><span class="o">,</span><span class="nn">math</span>

<span class="c1">##############################################NAMELIST BASE CLASS TO SHARE COMMON METHODS#########################</span>

<span class="c1">#These dictionaries represent the recognized options read from quantum espresso namelists</span>
<span class="n">QUANTUM_ESPRESSO_INT_LIST</span> <span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;CONTROL&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nstep&#39;</span><span class="p">,</span><span class="s1">&#39;iprint&#39;</span><span class="p">,</span><span class="s1">&#39;nberrycyc&#39;</span><span class="p">,</span><span class="s1">&#39;gdir&#39;</span><span class="p">,</span><span class="s1">&#39;nppstr&#39;</span><span class="p">],</span>
            <span class="s1">&#39;SYSTEM&#39;</span> <span class="p">:[</span><span class="s1">&#39;ibrav&#39;</span><span class="p">,</span><span class="s1">&#39;nat&#39;</span><span class="p">,</span><span class="s1">&#39;ntyp&#39;</span><span class="p">,</span><span class="s1">&#39;nbnd&#39;</span><span class="p">,</span><span class="s1">&#39;nr1&#39;</span><span class="p">,</span><span class="s1">&#39;nr2&#39;</span><span class="p">,</span><span class="s1">&#39;nr3&#39;</span><span class="p">,</span><span class="s1">&#39;nr1s&#39;</span><span class="p">,</span><span class="s1">&#39;nr2s&#39;</span><span class="p">,</span><span class="s1">&#39;nr3s&#39;</span><span class="p">,</span><span class="s1">&#39;nspin&#39;</span><span class="p">,</span>\
                    <span class="s1">&#39;nqx1&#39;</span><span class="p">,</span><span class="s1">&#39;nqx2&#39;</span><span class="p">,</span><span class="s1">&#39;nqx3&#39;</span><span class="p">,</span><span class="s1">&#39;lda_plus_u_kind&#39;</span><span class="p">,</span><span class="s1">&#39;edir&#39;</span><span class="p">,</span><span class="s1">&#39;report&#39;</span><span class="p">,</span><span class="s1">&#39;esm_nfit&#39;</span><span class="p">,</span><span class="s1">&#39;space_group&#39;</span><span class="p">,</span><span class="s1">&#39;origin_choice&#39;</span><span class="p">],</span>
            <span class="s1">&#39;ELECTRONS&#39;</span> <span class="p">:[</span><span class="s1">&#39;electron_maxstep&#39;</span><span class="p">,</span><span class="s1">&#39;mixing_ndim&#39;</span><span class="p">,</span><span class="s1">&#39;mixing_fixed_ns&#39;</span><span class="p">,</span><span class="s1">&#39;ortho_para&#39;</span><span class="p">,</span><span class="s1">&#39;diago_cg_maxiter&#39;</span><span class="p">,</span><span class="s1">&#39;diago_david_ndim&#39;</span><span class="p">],</span>
            <span class="s1">&#39;IONS&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nraise&#39;</span><span class="p">,</span><span class="s1">&#39;bfgs_ndim&#39;</span><span class="p">],</span>
            <span class="s1">&#39;CELL&#39;</span> <span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
<span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span> <span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;CONTROL&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;max_seconds&#39;</span><span class="p">,</span><span class="s1">&#39;etot_conv_thr&#39;</span><span class="p">,</span><span class="s1">&#39;forc_conv_thr&#39;</span><span class="p">],</span>
            <span class="s1">&#39;SYSTEM&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;celldm(1)&#39;</span><span class="p">,</span><span class="s1">&#39;celldm(2)&#39;</span><span class="p">,</span><span class="s1">&#39;celldm(3)&#39;</span><span class="p">,</span><span class="s1">&#39;celldm(4)&#39;</span><span class="p">,</span><span class="s1">&#39;celldm(5)&#39;</span><span class="p">,</span><span class="s1">&#39;celldm(6)&#39;</span><span class="p">,</span>\
                        <span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;cosab&#39;</span><span class="p">,</span><span class="s1">&#39;cosac&#39;</span><span class="p">,</span><span class="s1">&#39;cosbc&#39;</span><span class="p">,</span><span class="s1">&#39;tot_charge&#39;</span><span class="p">,</span><span class="s1">&#39;ecutwfc&#39;</span><span class="p">,</span><span class="s1">&#39;ecutrho&#39;</span><span class="p">,</span>\
                        <span class="s1">&#39;degauss&#39;</span><span class="p">,</span><span class="s1">&#39;ecfixed&#39;</span><span class="p">,</span><span class="s1">&#39;qcutz&#39;</span><span class="p">,</span><span class="s1">&#39;q2sigma&#39;</span><span class="p">,</span><span class="s1">&#39;exx_fraction&#39;</span><span class="p">,</span><span class="s1">&#39;screening_parameter&#39;</span><span class="p">,</span>\
                        <span class="s1">&#39;ecutvcut&#39;</span><span class="p">,</span><span class="s1">&#39;emaxpos&#39;</span><span class="p">,</span><span class="s1">&#39;eopreg&#39;</span><span class="p">,</span><span class="s1">&#39;eamp&#39;</span><span class="p">,</span><span class="s1">&#39;fixed_magnetization(1)&#39;</span><span class="p">,</span><span class="s1">&#39;fixed_magnetization(2)&#39;</span><span class="p">,</span><span class="s1">&#39;fixed_magnetization(3)&#39;</span>\
                        <span class="s1">&#39;lambda&#39;</span><span class="p">,</span><span class="s1">&#39;esm_w&#39;</span><span class="p">,</span><span class="s1">&#39;esm_efield&#39;</span><span class="p">,</span><span class="s1">&#39;fcp_mu&#39;</span><span class="p">,</span><span class="s1">&#39;london_s6&#39;</span><span class="p">,</span><span class="s1">&#39;london_rcut&#39;</span><span class="p">,</span><span class="s1">&#39;xdm_a1&#39;</span><span class="p">,</span><span class="s1">&#39;xdm_a2&#39;</span><span class="p">],</span>
            <span class="s1">&#39;ELECTRONS&#39;</span> <span class="p">:[</span><span class="s1">&#39;conv_thr&#39;</span><span class="p">,</span><span class="s1">&#39;conv_thr_init&#39;</span><span class="p">,</span><span class="s1">&#39;conv_thr_multi&#39;</span><span class="p">,</span><span class="s1">&#39;mixing_beta&#39;</span><span class="p">,</span><span class="s1">&#39;diago_thr_init&#39;</span><span class="p">,</span><span class="s1">&#39;efield&#39;</span><span class="p">,</span><span class="s1">&#39;efield_cart(1)&#39;</span><span class="p">,</span><span class="s1">&#39;efield_cart(2)&#39;</span><span class="p">,</span><span class="s1">&#39;efield_cart(3)&#39;</span><span class="p">],</span>
            <span class="s1">&#39;IONS&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tempw&#39;</span><span class="p">,</span><span class="s1">&#39;tolp&#39;</span><span class="p">,</span><span class="s1">&#39;delta_t&#39;</span><span class="p">,</span><span class="s1">&#39;upscale&#39;</span><span class="p">,</span><span class="s1">&#39;trust_radius_max&#39;</span><span class="p">,</span><span class="s1">&#39;trust_radius_max&#39;</span><span class="p">,</span><span class="s1">&#39;trust_radius_ini&#39;</span><span class="p">,</span><span class="s1">&#39;w_1&#39;</span><span class="p">,</span><span class="s1">&#39;w_2&#39;</span><span class="p">],</span>
            <span class="s1">&#39;CELL&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;press&#39;</span><span class="p">,</span><span class="s1">&#39;wmass&#39;</span><span class="p">,</span><span class="s1">&#39;cell_factor&#39;</span><span class="p">,</span><span class="s1">&#39;press_conv_thr&#39;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span> <span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;CONTROL&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;wf_collect&#39;</span><span class="p">,</span><span class="s1">&#39;tstress&#39;</span><span class="p">,</span><span class="s1">&#39;tprnfor&#39;</span><span class="p">,</span><span class="s1">&#39;lkpoint_dir&#39;</span><span class="p">,</span><span class="s1">&#39;tefield&#39;</span><span class="p">,</span><span class="s1">&#39;dipfield&#39;</span><span class="p">,</span>\
                        <span class="s1">&#39;lelfield&#39;</span><span class="p">,</span><span class="s1">&#39;lorbm&#39;</span><span class="p">,</span><span class="s1">&#39;lberry&#39;</span><span class="p">,</span><span class="s1">&#39;lfcpopt&#39;</span><span class="p">],</span>
            <span class="s1">&#39;SYSTEM&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;nosym&#39;</span><span class="p">,</span><span class="s1">&#39;nosym_evc&#39;</span><span class="p">,</span><span class="s1">&#39;noinv&#39;</span><span class="p">,</span><span class="s1">&#39;no_t_rev&#39;</span><span class="p">,</span><span class="s1">&#39;force_symmorphic&#39;</span><span class="p">,</span><span class="s1">&#39;use_all_frac&#39;</span><span class="p">,</span>\
                        <span class="s1">&#39;one_atom_occupations&#39;</span><span class="p">,</span><span class="s1">&#39;starting_spin_angle&#39;</span><span class="p">,</span><span class="s1">&#39;noncolin&#39;</span><span class="p">,</span><span class="s1">&#39;x_gamma_extrapolation&#39;</span><span class="p">,</span>\
                        <span class="s1">&#39;lda_plus_u&#39;</span><span class="p">,</span><span class="s1">&#39;lspinorb&#39;</span><span class="p">,</span><span class="s1">&#39;london&#39;</span><span class="p">,</span><span class="s1">&#39;xdm&#39;</span><span class="p">,</span><span class="s1">&#39;uniqueb&#39;</span><span class="p">,</span><span class="s1">&#39;rhombohedral&#39;</span><span class="p">],</span>
            <span class="s1">&#39;ELECTRONS&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;scf_must_converge&#39;</span><span class="p">,</span><span class="s1">&#39;adaptive_thr&#39;</span><span class="p">,</span><span class="s1">&#39;diago_full_acc&#39;</span><span class="p">,</span><span class="s1">&#39;tqr&#39;</span><span class="p">],</span>
            <span class="s1">&#39;IONS&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;remove_rigid_rot&#39;</span><span class="p">,</span><span class="s1">&#39;refold_pos&#39;</span><span class="p">],</span>
            <span class="s1">&#39;CELL&#39;</span> <span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
<span class="n">QUANTUM_ESPRESSO_STR_LIST</span> <span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;CONTROL&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;calculation&#39;</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;verbosity&#39;</span><span class="p">,</span><span class="s1">&#39;restart_mode&#39;</span><span class="p">,</span><span class="s1">&#39;outdir&#39;</span><span class="p">,</span><span class="s1">&#39;wfcdir&#39;</span><span class="p">,</span>\
                        <span class="s1">&#39;prefix&#39;</span><span class="p">,</span><span class="s1">&#39;disk_io&#39;</span><span class="p">,</span><span class="s1">&#39;pseudo_dir&#39;</span><span class="p">],</span>
            <span class="s1">&#39;SYSTEM&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;occupations&#39;</span><span class="p">,</span><span class="s1">&#39;smearing&#39;</span><span class="p">,</span><span class="s1">&#39;input_dft&#39;</span><span class="p">,</span><span class="s1">&#39;exxdiv_treatment&#39;</span><span class="p">,</span><span class="s1">&#39;u_projection_type&#39;</span><span class="p">,</span><span class="s1">&#39;constrained_magnetization&#39;</span>\
                        <span class="s1">&#39;assume_isolated&#39;</span><span class="p">,</span><span class="s1">&#39;esm_bc&#39;</span><span class="p">,</span><span class="s1">&#39;vdw_corr&#39;</span><span class="p">],</span>
            <span class="s1">&#39;ELECTRONS&#39;</span> <span class="p">:[</span><span class="s1">&#39;mixing_mode&#39;</span><span class="p">,</span><span class="s1">&#39;diagonalization&#39;</span><span class="p">,</span><span class="s1">&#39;startingpot&#39;</span><span class="p">,</span><span class="s1">&#39;startingwfc&#39;</span><span class="p">],</span>
            <span class="s1">&#39;IONS&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;ion_dynamics&#39;</span><span class="p">,</span><span class="s1">&#39;ion_positions&#39;</span><span class="p">,</span><span class="s1">&#39;pot_extrapolation&#39;</span><span class="p">,</span><span class="s1">&#39;wfc_extrapolation&#39;</span><span class="p">,</span><span class="s1">&#39;ion_temperature&#39;</span><span class="p">],</span>
            <span class="s1">&#39;CELL&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;cell_dynamics&#39;</span><span class="p">,</span><span class="s1">&#39;cell_dofree&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">QUANTUM_ESPRESSO_TOTAL_LIST</span> <span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;CONTROL&#39;</span> <span class="p">:</span> <span class="n">QUANTUM_ESPRESSO_INT_LIST</span><span class="p">[</span><span class="s1">&#39;CONTROL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span><span class="p">[</span><span class="s1">&#39;CONTROL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span><span class="p">[</span><span class="s1">&#39;CONTROL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_STR_LIST</span><span class="p">[</span><span class="s1">&#39;CONTROL&#39;</span><span class="p">],</span>
            <span class="s1">&#39;SYSTEM&#39;</span> <span class="p">:</span> <span class="n">QUANTUM_ESPRESSO_INT_LIST</span><span class="p">[</span><span class="s1">&#39;SYSTEM&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span><span class="p">[</span><span class="s1">&#39;SYSTEM&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span><span class="p">[</span><span class="s1">&#39;SYSTEM&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_STR_LIST</span><span class="p">[</span><span class="s1">&#39;SYSTEM&#39;</span><span class="p">],</span>
            <span class="s1">&#39;ELECTRONS&#39;</span> <span class="p">:</span><span class="n">QUANTUM_ESPRESSO_INT_LIST</span><span class="p">[</span><span class="s1">&#39;ELECTRONS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span><span class="p">[</span><span class="s1">&#39;ELECTRONS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span><span class="p">[</span><span class="s1">&#39;ELECTRONS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_STR_LIST</span><span class="p">[</span><span class="s1">&#39;ELECTRONS&#39;</span><span class="p">],</span>
            <span class="s1">&#39;IONS&#39;</span> <span class="p">:</span> <span class="n">QUANTUM_ESPRESSO_INT_LIST</span><span class="p">[</span><span class="s1">&#39;IONS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span><span class="p">[</span><span class="s1">&#39;IONS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span><span class="p">[</span><span class="s1">&#39;IONS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_STR_LIST</span><span class="p">[</span><span class="s1">&#39;IONS&#39;</span><span class="p">],</span>
            <span class="s1">&#39;CELL&#39;</span> <span class="p">:</span> <span class="n">QUANTUM_ESPRESSO_INT_LIST</span><span class="p">[</span><span class="s1">&#39;CELL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span><span class="p">[</span><span class="s1">&#39;CELL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span><span class="p">[</span><span class="s1">&#39;CELL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_STR_LIST</span><span class="p">[</span><span class="s1">&#39;CELL&#39;</span><span class="p">]</span>
<span class="p">}</span>




<span class="n">QUANTUM_ESPRESSO_CONTROL_LIST</span> <span class="o">=</span> <span class="n">QUANTUM_ESPRESSO_INT_LIST</span><span class="p">[</span><span class="s1">&#39;CONTROL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span><span class="p">[</span><span class="s1">&#39;CONTROL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span><span class="p">[</span><span class="s1">&#39;CONTROL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_STR_LIST</span><span class="p">[</span><span class="s1">&#39;CONTROL&#39;</span><span class="p">]</span>
<span class="n">QUANTUM_ESPRESSO_SYSTEM_LIST</span> <span class="o">=</span> <span class="n">QUANTUM_ESPRESSO_INT_LIST</span><span class="p">[</span><span class="s1">&#39;SYSTEM&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span><span class="p">[</span><span class="s1">&#39;SYSTEM&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span><span class="p">[</span><span class="s1">&#39;SYSTEM&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_STR_LIST</span><span class="p">[</span><span class="s1">&#39;SYSTEM&#39;</span><span class="p">]</span>
<span class="n">QUANTUM_ESPRESSO_ELECTRONS_LIST</span> <span class="o">=</span> <span class="n">QUANTUM_ESPRESSO_INT_LIST</span><span class="p">[</span><span class="s1">&#39;ELECTRONS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span><span class="p">[</span><span class="s1">&#39;ELECTRONS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span><span class="p">[</span><span class="s1">&#39;ELECTRONS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_STR_LIST</span><span class="p">[</span><span class="s1">&#39;ELECTRONS&#39;</span><span class="p">]</span>
<span class="n">QUANTUM_ESPRESSO_IONS_LIST</span> <span class="o">=</span> <span class="n">QUANTUM_ESPRESSO_INT_LIST</span><span class="p">[</span><span class="s1">&#39;IONS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span><span class="p">[</span><span class="s1">&#39;IONS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span><span class="p">[</span><span class="s1">&#39;IONS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_STR_LIST</span><span class="p">[</span><span class="s1">&#39;IONS&#39;</span><span class="p">]</span>
<span class="n">QUANTUM_ESPRESSO_CELL_LIST</span> <span class="o">=</span> <span class="n">QUANTUM_ESPRESSO_INT_LIST</span><span class="p">[</span><span class="s1">&#39;CELL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span><span class="p">[</span><span class="s1">&#39;CELL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span><span class="p">[</span><span class="s1">&#39;CELL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_STR_LIST</span><span class="p">[</span><span class="s1">&#39;CELL&#39;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">NamelistError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span>

<span class="k">class</span> <span class="nc">NamelistBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Namelist class contains:</span>
<span class="sd">        title: header of the namelist</span>
<span class="sd">        tags: a dict of all Namelist tags</span>

<span class="sd">    All namelist tags and associated values are stored as key-value pairs in the dictionary called &#39;tags&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">nameliststring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct a Namelist object from &#39;nameliststring&#39;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nameliststring</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nameliststring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read a  namelist &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="n">line_segments</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">nameliststring</span><span class="p">)</span>
        <span class="c1"># parse nameliststringlist into self.tags</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_segments</span><span class="p">:</span>
                <span class="n">commasplit</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">commasplit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">commasplit</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span> <span class="s1">&#39;!&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span>  <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verify_tags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_natural_type</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_make_natural_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Convert self.tags values from strings into their &#39;natural type&#39; (int, float, etc.) &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">QUANTUM_ESPRESSO_INT_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">NamelistError</span><span class="p">(</span><span class="s2">&quot;Could not convert &#39;&quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;&#39; : &#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39; to int&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">NamelistError</span><span class="p">(</span><span class="s2">&quot;Could not convert &#39;&quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;&#39; : &#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39; to float&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.true.&#39;</span><span class="p">,</span><span class="s1">&#39;.false.&#39;</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="n">NamelistError</span><span class="p">(</span><span class="s2">&quot;Could not find &#39;&quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;&#39; : &#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;&#39; in [&#39;.true.&#39;,&#39;.false.&#39;]&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.true.&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">QUANTUM_ESPRESSO_STR_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_string_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_verify_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that only allowed Namelist tags are in self.tags &quot;&quot;&quot;</span>
        <span class="n">TOT_LIST</span> <span class="o">=</span> <span class="n">QUANTUM_ESPRESSO_INT_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_FLOAT_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_BOOL_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">]</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_STR_LIST</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">TOT_LIST</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: unknown &quot;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s2">&quot; tag &#39;&quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;&#39; with value &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert namelist to string for writing&quot;&quot;&quot;</span>
        <span class="n">nameliststr</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">nameliststr</span><span class="o">=</span> <span class="n">nameliststr</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot; = .&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nameliststr</span><span class="o">=</span> <span class="n">nameliststr</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span> 
        <span class="k">return</span> <span class="n">nameliststr</span>

    <span class="k">def</span> <span class="nf">_check_string_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="c1">##############################################CONTROL MODULE BEGINS HERE############################################</span>
<div class="viewcode-block" id="ControlError"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.ControlError.html#casm.quantumespresso.qeio.ControlError">[docs]</a><span class="k">class</span> <span class="nc">ControlError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span></div>

<div class="viewcode-block" id="Control"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Control.html#casm.quantumespresso.qeio.Control">[docs]</a><span class="k">class</span> <span class="nc">Control</span><span class="p">(</span><span class="n">NamelistBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Control class contains:</span>
<span class="sd">        tags: a dict of all Control tags</span>

<span class="sd">    All namelist tags and associated values are stored as key-value pairs in the dictionary called &#39;tags&#39;.</span>
<span class="sd">   &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Control.__init__"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Control.html#casm.quantumespresso.qeio.Control.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">nameliststring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct a Control object from &#39;nameliststring&#39;&quot;&quot;&quot;</span>
        <span class="c1">#self.read(nameliststring)</span>
        <span class="n">NamelistBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">nameliststring</span><span class="p">)</span></div>

<div class="viewcode-block" id="Control._check_string_tag"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Control.html#casm.quantumespresso.qeio.Control._check_string_tag">[docs]</a>    <span class="k">def</span> <span class="nf">_check_string_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that string-valued tags are allowed values &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;calculation&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;scf&#39;&quot;</span> <span class="p">,</span><span class="s2">&quot;&#39;nscf&#39;&quot;</span> <span class="p">,</span><span class="s2">&quot;&#39;bands&#39;&quot;</span> <span class="p">,</span><span class="s2">&quot;&#39;relax&#39;&quot;</span> <span class="p">,</span><span class="s2">&quot;&#39;md&#39;&quot;</span> <span class="p">,</span><span class="s2">&quot;&#39;vc-relax&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;vc-md&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">ControlError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;calculation&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;low&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;medium&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;debug&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;high&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;default&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;minimal&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">ControlError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;verbosity&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;restart_mode&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;from_scratch&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;restart&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">ControlError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;restart_mode&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;disk_io&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;high&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;medium&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;low&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;none&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">ControlError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;disk_io&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span></div></div>

<span class="c1">##############################################END CONTROL MODULE#############################################################</span>



<span class="c1">##############################################SYSTEM MODULE BEGINS HERE############################################</span>
<div class="viewcode-block" id="SystemError"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.SystemError.html#casm.quantumespresso.qeio.SystemError">[docs]</a><span class="k">class</span> <span class="nc">SystemError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span></div>

<div class="viewcode-block" id="System"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.System.html#casm.quantumespresso.qeio.System">[docs]</a><span class="k">class</span> <span class="nc">System</span><span class="p">(</span><span class="n">NamelistBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Sys class contains:</span>
<span class="sd">        tags: a dict of all System tags</span>

<span class="sd">    All namelist tags and associated values are stored as key-value pairs in the dictionary called &#39;tags&#39;.</span>
<span class="sd">   &quot;&quot;&quot;</span>
<div class="viewcode-block" id="System.__init__"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.System.html#casm.quantumespresso.qeio.System.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">nameliststring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct a Sys object from &#39;nameliststring&#39;&quot;&quot;&quot;</span>
        <span class="n">NamelistBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">nameliststring</span><span class="p">)</span></div>

<div class="viewcode-block" id="System._check_string_tag"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.System.html#casm.quantumespresso.qeio.System._check_string_tag">[docs]</a>    <span class="k">def</span> <span class="nf">_check_string_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that string-valued tags are allowed values &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;occupations&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;smearing&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;tetrahedra&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;fixed&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;from_input&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">SysError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;occupations&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;smearing&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;gaussian&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;gauss&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;methfessel-paxton&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;m-p&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;mp&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;marzari-vanderbilt&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;cold&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;m-v&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;mv&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;fermi-dirac&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;f-d&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;fd&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">SysError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;smearing&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;exxdiv_treatment&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;gygi-baldereschi&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;vcut_spherical&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;vcut_ws&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;none&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">SysError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;exxdiv_treatment&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;u_projection_type&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;atomic&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;ortho-atomic&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;norm-atomic&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;file&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;pseudo&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">SysError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;U_projection_type&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;constrained_magnetization&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;none&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;total&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;atomic&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;total direction&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;atomic direction&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">SysError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;constrained_magnetization&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;assume_isolated&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;none&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;makov-payne&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;m-p&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;mp&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;martyna-tuckerman&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;m-t&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;mt&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;esm&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">SysError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;assumed_isolated&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;esm_bc&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;pbc&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;bc1&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;bc2&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;bc3&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">SysError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;esm_bc&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;vdw_corr&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;grimme-d2&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;dft-d&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;ts&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;ts-vdw&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;xdm&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">SysError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;esm_bc&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span></div></div>

<span class="c1">##############################################END SYSTEM MODULE#############################################################</span>



<span class="c1">##############################################ELECTRONS MODULE BEGINS HERE############################################</span>
<div class="viewcode-block" id="ElectronsError"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.ElectronsError.html#casm.quantumespresso.qeio.ElectronsError">[docs]</a><span class="k">class</span> <span class="nc">ElectronsError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span></div>

<div class="viewcode-block" id="Electrons"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Electrons.html#casm.quantumespresso.qeio.Electrons">[docs]</a><span class="k">class</span> <span class="nc">Electrons</span><span class="p">(</span><span class="n">NamelistBase</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Electrons class contains:</span>
<span class="sd">        tags: a dict of all Electrons tags</span>

<span class="sd">    All namelist tags and associated values are stored as key-value pairs in the dictionary called &#39;tags&#39;.</span>
<span class="sd">   &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Electrons.__init__"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Electrons.html#casm.quantumespresso.qeio.Electrons.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> <span class="n">nameliststring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct an Electrons object from &#39;nameliststring&#39;&quot;&quot;&quot;</span>
        <span class="n">NamelistBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">nameliststring</span><span class="p">)</span></div>

<div class="viewcode-block" id="Electrons._check_string_tag"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Electrons.html#casm.quantumespresso.qeio.Electrons._check_string_tag">[docs]</a>    <span class="k">def</span> <span class="nf">_check_string_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that string-valued tags are allowed values &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mixing_mode&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;plain&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;tf&#39;&quot;</span> <span class="p">,</span><span class="s2">&quot;&#39;local-tf&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">ElectronsError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;mixing_mode&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;diagonalization&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;david&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;cg&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;cg-serial&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">ElectronsError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;diagonalization&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;startingpot&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;atomic&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;file&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">ElectronsError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;startingpot&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;startingwfc&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;atomic&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;atomic+random&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;random&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;file&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">ElectronsError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;startingwfc&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span></div></div>
                
<span class="c1">##############################################END ELECTRONS MODULE#############################################################</span>



<span class="c1">##############################################IONS MODULE BEGINS HERE############################################</span>
<div class="viewcode-block" id="IonsError"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.IonsError.html#casm.quantumespresso.qeio.IonsError">[docs]</a><span class="k">class</span> <span class="nc">IonsError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span></div>

<div class="viewcode-block" id="Ions"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Ions.html#casm.quantumespresso.qeio.Ions">[docs]</a><span class="k">class</span> <span class="nc">Ions</span><span class="p">(</span><span class="n">NamelistBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Ions class contains:</span>
<span class="sd">        tags: a dict of all Ions tags</span>

<span class="sd">    All namelist tags and associated values are stored as key-value pairs in the dictionary called &#39;tags&#39;.</span>
<span class="sd">   &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Ions.__init__"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Ions.html#casm.quantumespresso.qeio.Ions.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> <span class="n">nameliststring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct an Ions object from &#39;nameliststring&#39;&quot;&quot;&quot;</span>
        <span class="n">NamelistBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">nameliststring</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="Ions._check_string_tag"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Ions.html#casm.quantumespresso.qeio.Ions._check_string_tag">[docs]</a>    <span class="k">def</span> <span class="nf">_check_string_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that string-valued tags are allowed values &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ion_dynamics&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;bfgs&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;damp&#39;&quot;</span> <span class="p">,</span><span class="s2">&quot;&#39;verlet&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;langevin&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;langevin-smc&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;beeman&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">IonsError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;ion_dynamics&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ion_positions&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;default&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;from_input&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">IonsError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;ion_positions&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;pot_extrapolation&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;none&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;atomic&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;first_order&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;second_order&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">IonsError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;pot_extrapolation&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;wfc_extrapolation&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;none&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;first_order&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;second_order&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">IonsError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;wfc_extrapolation&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ion_temperature&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;rescaling&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;rescale-v&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;rescale-t&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;reduce-t&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;berendsen&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;andersen&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;initial&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;not_controlled&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">IonsError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;ion_temperature&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span></div></div>

<span class="c1">##############################################END IONS MODULE#############################################################</span>

<span class="c1">##############################################CELL MODULE BEGINS HERE############################################</span>

<div class="viewcode-block" id="CellError"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.CellError.html#casm.quantumespresso.qeio.CellError">[docs]</a><span class="k">class</span> <span class="nc">CellError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span></div>


<div class="viewcode-block" id="Cell"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Cell.html#casm.quantumespresso.qeio.Cell">[docs]</a><span class="k">class</span> <span class="nc">Cell</span><span class="p">(</span><span class="n">NamelistBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Cell class contains:</span>
<span class="sd">        tags: a dict of all Cell tags</span>

<span class="sd">    All namelist tags and associated values are stored as key-value pairs in the dictionary called &#39;tags&#39;.</span>
<span class="sd">   &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Cell.__init__"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Cell.html#casm.quantumespresso.qeio.Cell.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">nameliststring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct a Cell object from &#39;nameliststring&#39;&quot;&quot;&quot;</span>
        <span class="n">NamelistBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">nameliststring</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cell._check_string_tag"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Cell.html#casm.quantumespresso.qeio.Cell._check_string_tag">[docs]</a>    <span class="k">def</span> <span class="nf">_check_string_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that string-valued tags are allowed values &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;cell_dynamics&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;bfgs&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;damp-pr&#39;&quot;</span> <span class="p">,</span><span class="s2">&quot;&#39;damp-w&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;none&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;sd&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;pr&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;w&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">CellError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;cell_dynamics&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;cell_dofree&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;all&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;x&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;y&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;z&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;xy&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;xz&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;yz&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;xyz&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;shape&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;volume&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;2dxy&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;2dshape&#39;&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">CellError</span><span class="p">(</span><span class="s2">&quot;Unknown &#39;cell_dofree&#39; value: &#39;&quot;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span></div></div>

<span class="c1">##############################################END CELL MODULE#############################################################</span>

<span class="c1">##############################################ATOMIC_SPECIES MODULE BEGINS HERE############################################</span>
<div class="viewcode-block" id="AtomicSpeciesError"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.AtomicSpeciesError.html#casm.quantumespresso.qeio.AtomicSpeciesError">[docs]</a><span class="k">class</span> <span class="nc">AtomicSpeciesError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span></div>

<div class="viewcode-block" id="AtomicSpecies"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.AtomicSpecies.html#casm.quantumespresso.qeio.AtomicSpecies">[docs]</a><span class="k">class</span> <span class="nc">AtomicSpecies</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The AtomicSpecies class contains:</span>
<span class="sd">        species: A list of all atomic species</span>
<span class="sd">        masses: A list of all atomic mass of the corresponding species</span>
<span class="sd">        pseudos: A list of all pseudo potential files for the corresponding species</span>
<span class="sd">   &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AtomicSpecies.__init__"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.AtomicSpecies.html#casm.quantumespresso.qeio.AtomicSpecies.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cardstring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct an AtomicSpecies object from &#39;cardstring&#39;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">cardstring</span><span class="p">)</span></div>

<div class="viewcode-block" id="AtomicSpecies.read"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.AtomicSpecies.html#casm.quantumespresso.qeio.AtomicSpecies.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cardstring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read an AtomicSpecies card &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">masses</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pseudos</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">line_segments</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">cardstring</span><span class="p">)</span>
        <span class="c1"># parse card into self.species, self.masses, self.pseudos</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_segments</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">line</span><span class="o">=</span><span class="nb">filter</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">+</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">masses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">masses</span> <span class="o">+</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">))]</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">AtomicSpeciesError</span><span class="p">(</span><span class="s2">&quot;Could not convert mass to float&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pseudos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudos</span> <span class="o">+</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span></div>
    
<div class="viewcode-block" id="AtomicSpecies.make_string"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.AtomicSpecies.html#casm.quantumespresso.qeio.AtomicSpecies.make_string">[docs]</a>    <span class="k">def</span> <span class="nf">make_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert card to string for writing&quot;&quot;&quot;</span>
        <span class="n">cardstr</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">specie</span><span class="p">,</span><span class="n">mass</span><span class="p">,</span><span class="n">pseudo</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">masses</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pseudos</span><span class="p">):</span>
                <span class="n">cardstr</span><span class="o">=</span> <span class="n">cardstr</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">specie</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">pseudo</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> 
        <span class="k">return</span> <span class="n">cardstr</span></div></div>
<span class="c1">##############################################END ATOMIC_SPECIES MODULE#############################################################</span>


<span class="c1">##############################################ATOMIC_POSITIONS MODULE BEGINS HERE############################################</span>
<div class="viewcode-block" id="AtomicPositionsError"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.AtomicPositionsError.html#casm.quantumespresso.qeio.AtomicPositionsError">[docs]</a><span class="k">class</span> <span class="nc">AtomicPositionsError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span></div>

<div class="viewcode-block" id="AtomicPositions"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.AtomicPositions.html#casm.quantumespresso.qeio.AtomicPositions">[docs]</a><span class="k">class</span> <span class="nc">AtomicPositions</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The AtomicPositions class contains:</span>
<span class="sd">        units: The type of units for positions</span>
<span class="sd">        coords: A list of all atomic and coordinates for each species along with fixing switches</span>
<span class="sd">   &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AtomicPositions.__init__"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.AtomicPositions.html#casm.quantumespresso.qeio.AtomicPositions.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cardstring</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct an AtomicSpecies object from &#39;cardstring&#39;&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">units</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;alat&quot;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">=</span><span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">cardstring</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span></div>

<div class="viewcode-block" id="AtomicPositions.read"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.AtomicPositions.html#casm.quantumespresso.qeio.AtomicPositions.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cardstring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read an AtomicSpecies card &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">line_segments</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">cardstring</span><span class="p">)</span>
        <span class="c1"># parse card into self.coords</span>
        <span class="c1"># NOTE: This function has trouble because it assumes integer and float arithmetic are separate unlike the documentation of Quantum Espresso indicates.</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_segments</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">+</span> <span class="p">[(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),[</span><span class="nb">float</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">))),</span><span class="nb">float</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">))),</span><span class="nb">float</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">)))])]</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">AtomicPositionsError</span><span class="p">(</span><span class="s2">&quot;Could not convert coordinates to floats&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">+</span> <span class="p">[(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),[</span><span class="nb">float</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">))),</span><span class="nb">float</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">))),</span><span class="nb">float</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">)))],[</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())])]</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">AtomicPositionsError</span><span class="p">(</span><span class="s2">&quot;Could not convert coordinates to floats or if_pos to ints&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AtomicPositions._check_units"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.AtomicPositions.html#casm.quantumespresso.qeio.AtomicPositions._check_units">[docs]</a>    <span class="k">def</span> <span class="nf">_check_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that units is one of allowed values&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;alat&#39;</span><span class="p">,</span><span class="s1">&#39;bohr&#39;</span> <span class="p">,</span><span class="s1">&#39;angstrom&#39;</span><span class="p">,</span><span class="s1">&#39;crystal&#39;</span><span class="p">,</span><span class="s1">&#39;crystal_sg&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">AtomicPositionsError</span><span class="p">(</span><span class="s2">&quot;Unknown coordinate units:&#39;&quot;</span> <span class="o">+</span> <span class="n">units</span><span class="p">)</span></div>
        
    
<div class="viewcode-block" id="AtomicPositions.make_string"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.AtomicPositions.html#casm.quantumespresso.qeio.AtomicPositions.make_string">[docs]</a>    <span class="k">def</span> <span class="nf">make_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert card to string for writing&quot;&quot;&quot;</span>
        <span class="n">cardstr</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">cardstr</span><span class="o">=</span> <span class="n">cardstr</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cardstr</span><span class="o">=</span> <span class="n">cardstr</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> 
        <span class="k">return</span> <span class="n">cardstr</span></div></div>
<span class="c1">##############################################END ATOMIC_POSITIONS MODULE#############################################################</span>

<span class="c1">##############################################CELL_PARAMETERS MODULE BEGINS HERE############################################</span>
<div class="viewcode-block" id="CellParametersError"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.CellParametersError.html#casm.quantumespresso.qeio.CellParametersError">[docs]</a><span class="k">class</span> <span class="nc">CellParametersError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span></div>

<div class="viewcode-block" id="CellParameters"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.CellParameters.html#casm.quantumespresso.qeio.CellParameters">[docs]</a><span class="k">class</span> <span class="nc">CellParameters</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The CellParameters class contains:</span>
<span class="sd">        units: The type of units for vectors</span>
<span class="sd">        vectors: A list of all lattice vectors in the above units</span>
<span class="sd">   &quot;&quot;&quot;</span>
<div class="viewcode-block" id="CellParameters.__init__"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.CellParameters.html#casm.quantumespresso.qeio.CellParameters.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cardstring</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct a CellParameters object from &#39;cardstring&#39;&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">units</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;alat&quot;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">=</span><span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">cardstring</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span></div>

<div class="viewcode-block" id="CellParameters.read"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.CellParameters.html#casm.quantumespresso.qeio.CellParameters.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cardstring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read a CellParameters card &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">line_segments</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">cardstring</span><span class="p">)</span>
        <span class="c1"># parse card into self.vectors</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_segments</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectors</span> <span class="o">+</span> <span class="p">[[</span><span class="nb">float</span><span class="p">((</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">))),</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">)),</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">))]]</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">CellParametersError</span><span class="p">(</span><span class="s2">&quot;Could not convert vector coordinates to floats&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CellParametersError</span><span class="p">(</span><span class="s2">&quot;Lattice Shape Error:&quot;</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">))</span></div>

<div class="viewcode-block" id="CellParameters._check_units"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.CellParameters.html#casm.quantumespresso.qeio.CellParameters._check_units">[docs]</a>    <span class="k">def</span> <span class="nf">_check_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that units is one of allowed values&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;alat&#39;</span><span class="p">,</span><span class="s1">&#39;bohr&#39;</span> <span class="p">,</span><span class="s1">&#39;angstrom&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">CellParametersError</span><span class="p">(</span><span class="s2">&quot;Unknown coordinate units:&#39;&quot;</span> <span class="o">+</span> <span class="n">units</span><span class="p">)</span></div>
        
    
<div class="viewcode-block" id="CellParameters.make_string"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.CellParameters.html#casm.quantumespresso.qeio.CellParameters.make_string">[docs]</a>    <span class="k">def</span> <span class="nf">make_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert card to string for writing&quot;&quot;&quot;</span>
        <span class="n">cardstr</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectors</span><span class="p">:</span>
            <span class="n">cardstr</span><span class="o">=</span> <span class="n">cardstr</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vector</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vector</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vector</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">cardstr</span></div></div>
<span class="c1">##############################################END CELL_PARAMETERS MODULE#############################################################</span>


<span class="c1">##############################################K_POINTS MODULE BEGINS HERE############################################</span>
<div class="viewcode-block" id="KPointsError"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.KPointsError.html#casm.quantumespresso.qeio.KPointsError">[docs]</a><span class="k">class</span> <span class="nc">KPointsError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span></div>

<div class="viewcode-block" id="KPoints"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.KPoints.html#casm.quantumespresso.qeio.KPoints">[docs]</a><span class="k">class</span> <span class="nc">KPoints</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The KPoints class contains:</span>
<span class="sd">        units: The type of K-point meshing</span>
<span class="sd">        coords: A list of all kpoints</span>
<span class="sd">        nks: number of kpoints (if the kpoints are given as a list)</span>
<span class="sd">   &quot;&quot;&quot;</span>
<div class="viewcode-block" id="KPoints.__init__"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.KPoints.html#casm.quantumespresso.qeio.KPoints.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cardstring</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct a KPoints object from &#39;cardstring&#39;&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">units</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;tpiba&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">=</span><span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nks</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_units</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">cardstring</span><span class="p">)</span></div>

<div class="viewcode-block" id="KPoints.read"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.KPoints.html#casm.quantumespresso.qeio.KPoints.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cardstring</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read a KPoints card &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">line_segments</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">cardstring</span><span class="p">)</span>
        <span class="c1"># parse card into self.species, self.masses, self.pseudos</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;gamma&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;automatic&quot;</span><span class="p">:</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span> <span class="c1">#automatic mesh settings are stored as [nk1,nk2,nk3,sk1,sk2,sk3]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">KPointsError</span><span class="p">(</span><span class="s2">&quot;Could not convert meshsizing to ints&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">KPointsError</span><span class="p">(</span><span class="s2">&quot;Incorrect format for automatic K_POINT Meshing&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nks</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">line_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">KPointsError</span><span class="p">(</span><span class="s2">&quot;Non integer number of kpoints&quot;</span><span class="p">)</span>
            <span class="n">line_segments</span><span class="o">=</span><span class="n">line_segments</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_segments</span><span class="p">:</span>

                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">+</span> <span class="p">[((</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())),</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))]</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">KPointsError</span><span class="p">(</span><span class="s2">&quot;Could not convert coordinates or weights to floats&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="KPoints._check_units"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.KPoints.html#casm.quantumespresso.qeio.KPoints._check_units">[docs]</a>    <span class="k">def</span> <span class="nf">_check_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that units is one of allowed values&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">units</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tpiba&#39;</span><span class="p">,</span><span class="s1">&#39;crystal&#39;</span> <span class="p">,</span><span class="s1">&#39;tpiba_b&#39;</span><span class="p">,</span><span class="s1">&#39;crystal_b&#39;</span><span class="p">,</span><span class="s1">&#39;tpiba_c&#39;</span><span class="p">,</span><span class="s1">&#39;crystal_c&#39;</span><span class="p">,</span><span class="s1">&#39;automatic&#39;</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">KPointsError</span><span class="p">(</span><span class="s2">&quot;Unknown units:&#39;&quot;</span> <span class="o">+</span> <span class="n">units</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="KPoints.super_kpoints"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.KPoints.html#casm.quantumespresso.qeio.KPoints.super_kpoints">[docs]</a>    <span class="k">def</span> <span class="nf">super_kpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prim</span><span class="p">,</span> <span class="nb">super</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Assuming &#39;self&#39; is the kpoints associated with a PRIM, it uses a scaling method to calculate</span>
<span class="sd">                  the kpoint-mesh for a supercell, such that it has a equal or greater kpoint</span>
<span class="sd">                  density than the prim. </span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                super_kpoints: a Kpoints object for the supercell</span>
<span class="sd">            </span>
<span class="sd">            Args:</span>
<span class="sd">                prim: Poscar object for the prim OR None</span>
<span class="sd">                super: a Poscar object for the supercell </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">backup_prim</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">prim</span><span class="p">)</span>
        <span class="n">backup_super</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="nb">super</span><span class="p">)</span>
        <span class="n">super_kpoints</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        
        <span class="k">if</span> <span class="n">prim</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KpointsError</span><span class="p">(</span><span class="s2">&quot;No POSCAR was provided for the PRIM, so the PRIM KPOINTS could not be scaled!&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span> 
            <span class="nb">float</span><span class="p">(</span><span class="nb">super</span><span class="o">.</span><span class="n">scaling</span><span class="p">)</span>
            <span class="nb">super</span><span class="o">.</span><span class="n">scaling</span><span class="o">=</span><span class="s2">&quot;angstrom&quot;</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">prim</span><span class="o">.</span><span class="n">scaling</span> <span class="o">!=</span> <span class="nb">super</span><span class="o">.</span><span class="n">scaling</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING: The reference lattice vectors and newly scaled lattice vectors are not of same units!!!!&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">super</span><span class="o">.</span><span class="n">scaling</span> <span class="o">!=</span> <span class="s2">&quot;angstrom&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">super</span><span class="o">.</span><span class="n">scaling</span> <span class="o">==</span> <span class="s2">&quot;alat&quot;</span><span class="p">:</span>
                    <span class="nb">super</span><span class="o">.</span><span class="n">_lattice</span> <span class="o">=</span> <span class="nb">super</span><span class="o">.</span><span class="n">celldm</span><span class="o">*</span><span class="nb">super</span><span class="o">.</span><span class="n">_lattice</span>
                    <span class="nb">super</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="s2">&quot;bohr&quot;</span>
                <span class="k">if</span> <span class="nb">super</span><span class="o">.</span><span class="n">scaling</span> <span class="o">==</span> <span class="s2">&quot;bohr&quot;</span><span class="p">:</span>
                    <span class="nb">super</span><span class="o">.</span><span class="n">_lattice</span> <span class="o">=</span> <span class="mf">0.52918</span><span class="o">*</span><span class="nb">super</span><span class="o">.</span><span class="n">_lattice</span>
                    <span class="nb">super</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>
                <span class="nb">super</span><span class="o">.</span><span class="n">_reciprocal_lattice</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="nb">super</span><span class="o">.</span><span class="n">_lattice</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">prim</span><span class="o">.</span><span class="n">scaling</span> <span class="o">!=</span> <span class="s2">&quot;angstrom&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prim</span><span class="o">.</span><span class="n">scaling</span> <span class="o">==</span> <span class="s2">&quot;alat&quot;</span><span class="p">:</span>
                    <span class="n">prim</span><span class="o">.</span><span class="n">_lattice</span> <span class="o">=</span> <span class="n">prim</span><span class="o">.</span><span class="n">celldm</span><span class="o">*</span><span class="n">prim</span><span class="o">.</span><span class="n">_lattice</span>
                    <span class="n">prim</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="s2">&quot;bohr&quot;</span>
                <span class="k">if</span> <span class="n">prim</span><span class="o">.</span><span class="n">scaling</span> <span class="o">==</span> <span class="s2">&quot;bohr&quot;</span><span class="p">:</span>
                    <span class="n">prim</span><span class="o">.</span><span class="n">_lattice</span> <span class="o">=</span> <span class="mf">0.52918</span><span class="o">*</span><span class="n">prim</span><span class="o">.</span><span class="n">_lattice</span>
                    <span class="n">prim</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="s2">&quot;angstrom&quot;</span>
                <span class="n">prim</span><span class="o">.</span><span class="n">_reciprocal_lattice</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">prim</span><span class="o">.</span><span class="n">_lattice</span><span class="p">))</span>



        <span class="n">super_kpoints</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span> <span class="c1">#4th 5th and 6th numbers are shifts</span>
        
        <span class="c1"># calculate prim volumetric kpoint densities</span>
        <span class="n">prim_density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">prim</span><span class="p">)</span>
        
        <span class="c1"># calculate recip lattice vector lengths</span>
        <span class="n">super_recip_vec_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="nb">super</span><span class="o">.</span><span class="n">reciprocal_lattice</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        
        <span class="c1"># while supercell kpoint density is less than prim kpoint density</span>
        <span class="k">while</span> <span class="n">super_kpoints</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="nb">super</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">prim_density</span><span class="p">:</span>
            
            <span class="c1"># increase the number of subdivisions along the least dense super recip vector</span>
            <span class="n">linear_density</span> <span class="o">=</span> <span class="p">[</span><span class="n">super_kpoints</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">/</span><span class="n">super_recip_vec_lengths</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
            <span class="n">min_index</span> <span class="o">=</span> <span class="n">linear_density</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">linear_density</span><span class="p">))</span>
            <span class="n">super_kpoints</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="c1"># set all subdivisions to be at similar linear density </span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">super_kpoints</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span> <span class="o">/</span> <span class="n">super_recip_vec_lengths</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">super_kpoints</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">super_recip_vec_lengths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">0.1</span><span class="p">))</span>
        <span class="c1"># end while</span>
        <span class="n">prim</span> <span class="o">=</span> <span class="n">backup_prim</span>
        <span class="nb">super</span> <span class="o">=</span> <span class="n">backup_super</span>
        <span class="k">return</span> <span class="n">super_kpoints</span></div>
    
<div class="viewcode-block" id="KPoints.density"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.KPoints.html#casm.quantumespresso.qeio.KPoints.density">[docs]</a>    <span class="k">def</span> <span class="nf">density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poscar</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the kpoint density with respect to a Poscar.</span>
<span class="sd">            </span>
<span class="sd">            Args:</span>
<span class="sd">                poscar: a Poscar object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">poscar</span><span class="o">.</span><span class="n">reciprocal_volume</span><span class="p">()</span> </div>
    
<div class="viewcode-block" id="KPoints.make_string"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.KPoints.html#casm.quantumespresso.qeio.KPoints.make_string">[docs]</a>    <span class="k">def</span> <span class="nf">make_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert card to string for writing&quot;&quot;&quot;</span>
        <span class="n">cardstr</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;gamma&quot;</span><span class="p">:</span>
            <span class="n">cardstr</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;automatic&quot;</span><span class="p">:</span>
            <span class="n">cardstr</span><span class="o">=</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cardstr</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nks</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>    
            <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">cardstr</span><span class="o">=</span> <span class="n">cardstr</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> 
        <span class="k">return</span> <span class="n">cardstr</span></div></div>
<span class="c1">##############################################END K_POINTS MODULE#############################################################</span>

<span class="c1">########################################################INFILE MODULE BEGINS HERE############################################################</span>


<span class="c1"># List of namelists in Quantum espresso </span>
<span class="n">QUANTUM_ESPRESSO_NAMELIST_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CONTROL&#39;</span><span class="p">,</span><span class="s1">&#39;SYSTEM&#39;</span><span class="p">,</span><span class="s1">&#39;ELECTRONS&#39;</span><span class="p">,</span><span class="s1">&#39;IONS&#39;</span><span class="p">,</span><span class="s1">&#39;CELL&#39;</span><span class="p">,</span><span class="s1">&#39;INPUTPH&#39;</span><span class="p">,</span><span class="s1">&#39;PATH&#39;</span><span class="p">,</span>\
                                <span class="s1">&#39;INPUTCOND&#39;</span><span class="p">,</span><span class="s1">&#39;PRESS_AI&#39;</span><span class="p">,</span><span class="s1">&#39;WANNIER&#39;</span><span class="p">,</span><span class="s1">&#39;INPUTPP&#39;</span><span class="p">,</span><span class="s1">&#39;PLOT&#39;</span><span class="p">,</span><span class="s1">&#39;DOS&#39;</span><span class="p">,</span><span class="s1">&#39;BANDS&#39;</span><span class="p">,</span>\
                                <span class="s1">&#39;PROJWFC&#39;</span><span class="p">]</span>

<span class="c1">#List of namelists which have associated Classes</span>
<span class="n">QUANTUM_ESPRESSO_NAMELIST_OBJ_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CONTROL&#39;</span><span class="p">,</span><span class="s1">&#39;SYSTEM&#39;</span><span class="p">,</span><span class="s1">&#39;ELECTRONS&#39;</span><span class="p">,</span><span class="s1">&#39;IONS&#39;</span><span class="p">,</span><span class="s1">&#39;CELL&#39;</span><span class="p">]</span>

<span class="c1">#List of Cards in Quantum espresso</span>
<span class="n">QUANTUM_ESPRESSO_CARD_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">,</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">,</span><span class="s1">&#39;K_POINTS&#39;</span><span class="p">,</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">,</span>\
                                <span class="s1">&#39;CONSTRAINTS&#39;</span><span class="p">,</span><span class="s1">&#39;OCCUPATIONS&#39;</span><span class="p">,</span><span class="s1">&#39;ATOMIC_FORCES&#39;</span><span class="p">,</span><span class="s1">&#39;qPointsSpecs&#39;</span><span class="p">,</span>\
                                <span class="s1">&#39;CLIMBING_IMAGES&#39;</span><span class="p">,</span><span class="s1">&#39;K_and_Energy_Points&#39;</span><span class="p">,</span><span class="s1">&#39;ATOMIC_VELOCITIES&#39;</span><span class="p">,</span><span class="s1">&#39;REF_CELL_PARMETERS&#39;</span><span class="p">,</span>\
                                <span class="s1">&#39;PLOT_WANNIER&#39;</span><span class="p">,</span><span class="s1">&#39;AUTOPILOT&#39;</span><span class="p">]</span>

<span class="c1">#List of Cards in Quantum espresso which have associated Classes </span>
<span class="n">QUANTUM_ESPRESSO_CARD_OBJ_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">,</span><span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">,</span><span class="s1">&#39;K_POINTS&#39;</span><span class="p">,</span><span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">]</span>

<span class="n">QUANTUM_ESPRESSO_BLOCK_LIST</span><span class="o">=</span> <span class="n">QUANTUM_ESPRESSO_NAMELIST_LIST</span> <span class="o">+</span> <span class="n">QUANTUM_ESPRESSO_CARD_LIST</span>

<div class="viewcode-block" id="InfileError"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.InfileError.html#casm.quantumespresso.qeio.InfileError">[docs]</a><span class="k">class</span> <span class="nc">InfileError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span></div>

<div class="viewcode-block" id="Infile"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Infile.html#casm.quantumespresso.qeio.Infile">[docs]</a><span class="k">class</span> <span class="nc">Infile</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Infile class contains:</span>
<span class="sd">        namelists: a dict of all Infile namelists (which contain settings)</span>
<span class="sd">        cards: a dict of all Infile cards</span>

<span class="sd">    All input namelists and associated tag lists are stored as key-value pairs in the dictionary called &#39;namelists&#39;.</span>
<span class="sd">   &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Infile.__init__"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Infile.html#casm.quantumespresso.qeio.Infile.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">poscar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct an Infile object from &#39;filename&#39;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">poscar</span><span class="p">,</span> <span class="n">sort</span><span class="p">)</span></div>

<div class="viewcode-block" id="Infile.read"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Infile.html#casm.quantumespresso.qeio.Infile.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">species</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">poscar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read an .in file &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namelists</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cards</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">namelist_open</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">curr_namelist</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="n">nameliststring</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="n">card_open</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">curr_card</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="n">cardstring</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="n">extratag</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InfileError</span><span class="p">(</span><span class="s2">&quot;Could not open file: &#39;&quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># parse Infile into self.namelist and self.cards</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">:</span>
                <span class="c1">#The check a new namelist is a line starting with &amp;</span>
                <span class="k">if</span> <span class="n">namelist_open</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InfileError</span><span class="p">(</span><span class="s2">&quot;namelist embedding...Please check &#39;&quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;&#39; for proper formatting&quot;</span><span class="p">)</span>
                <span class="n">namelist_open</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">nameliststring</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                <span class="n">curr_namelist</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                <span class="c1">#The end of a namelist is denoted by /</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">namelist_open</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InfileError</span><span class="p">(</span><span class="s2">&quot;namelist embedding...Please check &#39;&quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;&#39; for proper formatting&quot;</span><span class="p">)</span>
                <span class="n">namelist_open</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">namelistobj</span><span class="o">=</span><span class="p">{</span>
                  <span class="s1">&#39;CONTROL&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">Control</span><span class="p">(</span><span class="n">curr_namelist</span><span class="p">,</span><span class="n">x</span><span class="p">),</span>
                  <span class="s1">&#39;SYSTEM&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">System</span><span class="p">(</span><span class="n">curr_namelist</span><span class="p">,</span><span class="n">x</span><span class="p">),</span>
                  <span class="s1">&#39;ELECTRONS&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">Electrons</span><span class="p">(</span><span class="n">curr_namelist</span><span class="p">,</span><span class="n">x</span><span class="p">),</span>
                  <span class="s1">&#39;IONS&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">Ions</span><span class="p">(</span><span class="n">curr_namelist</span><span class="p">,</span><span class="n">x</span><span class="p">),</span>
                  <span class="s1">&#39;CELL&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">Cell</span><span class="p">(</span><span class="n">curr_namelist</span><span class="p">,</span><span class="n">x</span><span class="p">),</span>
                <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_namelist</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)(</span><span class="n">nameliststring</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="p">[</span><span class="n">curr_namelist</span><span class="p">]</span><span class="o">=</span><span class="n">namelistobj</span>
            <span class="k">elif</span> <span class="n">namelist_open</span><span class="p">:</span>
              <span class="c1"># white space in name list is removed later on</span>
                    <span class="n">nameliststring</span><span class="o">=</span><span class="n">nameliststring</span> <span class="o">+</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">card_open</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="c1">#if a card isn&#39;t open for reading and empty line is found skip to next line</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> 
                        <span class="c1">#this check for the start of a card is a Capitalized phrase</span>
                        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
                            <span class="n">card_open</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">cardstring</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                            <span class="n">curr_card</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">extratag</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                            <span class="k">if</span> <span class="n">curr_card</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ATOMIC_POSITIONS&quot;</span><span class="p">,</span><span class="s2">&quot;K_POINTS&quot;</span><span class="p">,</span><span class="s2">&quot;CELL_PARAMETERS&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">2</span><span class="p">:</span>
                                <span class="n">extratag</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="c1">#the only way to check for end of card is an empty line</span>
                    <span class="c1"># new line type white space in card is detrimental because it ends the card prematurely</span>
                    <span class="n">card_open</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">cardobj</span><span class="o">=</span><span class="p">{</span>
                      <span class="s1">&#39;ATOMIC_SPECIES&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">AtomicSpecies</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                      <span class="s1">&#39;ATOMIC_POSITIONS&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">AtomicPositions</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">extratag</span><span class="p">),</span>
                      <span class="s1">&#39;K_POINTS&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">KPoints</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">extratag</span><span class="p">),</span>
                      <span class="s1">&#39;CELL_PARAMETERS&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">CellParameters</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">extratag</span><span class="p">),</span>
                    <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_card</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)(</span><span class="n">cardstring</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="n">curr_card</span><span class="p">]</span><span class="o">=</span><span class="n">cardobj</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cardstring</span><span class="o">=</span><span class="n">cardstring</span> <span class="o">+</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verify_blocks</span><span class="p">()</span>

        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Infile._verify_blocks"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Infile.html#casm.quantumespresso.qeio.Infile._verify_blocks">[docs]</a>    <span class="k">def</span> <span class="nf">_verify_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check that only allowed Infile namelists and cards are in self.namelists and self.cards &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">namelist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">namelist</span> <span class="ow">in</span> <span class="n">QUANTUM_ESPRESSO_NAMELIST_LIST</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: unknown Infile namelist: &quot;</span> <span class="o">+</span> <span class="n">namelist</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">QUANTUM_ESPRESSO_CARD_LIST</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: unknown Infile card: &quot;</span> <span class="o">+</span> <span class="n">card</span><span class="p">)</span></div>

<div class="viewcode-block" id="Infile.rewrite_poscar_info"><a class="viewcode-back" href="../../../../python/casm.quantumespresso.qeio.Infile.html#casm.quantumespresso.qeio.Infile.rewrite_poscar_info">[docs]</a>    <span class="k">def</span> <span class="nf">rewrite_poscar_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">poscar</span><span class="p">,</span><span class="n">species</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update Infile object to a new set of coordinates and lattice vectors&quot;&quot;&quot;</span>
        <span class="c1">## This function is called on subsequent runs of quantum espresso i.e. moving from run.0 to run.1 etc.</span>
        <span class="c1">## Knowing what is going on here is dependent on knowledge of quantumespresso/qeio/poscar.py</span>
        <span class="c1">## Knowing what is going on here is dependent on knowledge of quantumespresso/qeio/species.py</span>
        <span class="k">if</span> <span class="s2">&quot;CELL_PARAMETERS&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;CELL_PARAMETERS&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">CellParameters</span><span class="p">(</span><span class="s2">&quot;0.0 0.0 0.0 </span><span class="se">\n</span><span class="s2">  0.0 0.0 0.0 </span><span class="se">\n</span><span class="s2"> 0.0 0.0 0.0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">poscar</span><span class="o">.</span><span class="n">scaling</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;alat&#39;</span><span class="p">,</span><span class="s1">&#39;bohr&#39;</span><span class="p">,</span><span class="s1">&#39;angstrom&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;CELL_PARAMETERS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">=</span><span class="n">poscar</span><span class="o">.</span><span class="n">scaling</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;CELL_PARAMETERS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;angstrom&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;CELL_PARAMETERS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">vectors</span><span class="o">=</span><span class="n">poscar</span><span class="o">.</span><span class="n">_lattice</span>
        <span class="k">if</span> <span class="s2">&quot;SYSTEM&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="p">[</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;ibrav&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">if</span> <span class="s2">&quot;celldm(1)&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="p">[</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="p">[</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;celldm(1)&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;ATOMIC_POSITIONS&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">poscar</span><span class="o">.</span><span class="n">coord_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;alat&#39;</span><span class="p">,</span><span class="s1">&#39;bohr&#39;</span><span class="p">,</span><span class="s1">&#39;angstrom&#39;</span><span class="p">,</span><span class="s1">&#39;crystal&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_POSITIONS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">=</span><span class="n">poscar</span><span class="o">.</span><span class="n">coord_mode</span>
            <span class="k">elif</span> <span class="n">poscar</span><span class="o">.</span><span class="n">coord_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;d&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_POSITIONS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;crystal&quot;</span>
            <span class="k">elif</span> <span class="n">poscar</span><span class="o">.</span><span class="n">coord_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;c&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_POSITIONS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;angstrom&quot;</span>
            <span class="n">coords</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">specie</span> <span class="ow">in</span> <span class="n">poscar</span><span class="o">.</span><span class="n">basis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">specie</span><span class="o">.</span><span class="n">SD_FLAG</span> <span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">flags</span><span class="o">=</span><span class="n">specie</span><span class="o">.</span><span class="n">SD_FLAG</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">int_flags</span><span class="o">=</span><span class="p">[]</span>
                    <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
                        <span class="n">int_flags</span><span class="o">+=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;T&#39;</span> <span class="ow">or</span> <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">)]</span>
                    <span class="n">coords</span><span class="o">+=</span> <span class="p">[(</span><span class="n">specie</span><span class="o">.</span><span class="n">occ_alias</span><span class="p">,</span><span class="n">specie</span><span class="o">.</span><span class="n">position</span><span class="p">,</span><span class="n">int_flags</span><span class="p">)]</span>
                <span class="k">elif</span> <span class="n">species</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;if_pos&quot;</span> <span class="ow">in</span> <span class="n">species</span><span class="p">[</span><span class="n">specie</span><span class="o">.</span><span class="n">occupant</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">species</span><span class="p">[</span><span class="n">specie</span><span class="o">.</span><span class="n">occupant</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;if_pos&quot;</span><span class="p">]</span> <span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">flags</span><span class="o">=</span><span class="n">species</span><span class="p">[</span><span class="n">specie</span><span class="o">.</span><span class="n">occupant</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;if_pos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                        <span class="n">int_flags</span><span class="o">=</span><span class="p">[]</span>
                        <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
                            <span class="n">int_flags</span><span class="o">+=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;T&#39;</span> <span class="ow">or</span> <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">)]</span>
                        <span class="n">coords</span><span class="o">+=</span> <span class="p">[(</span><span class="n">specie</span><span class="o">.</span><span class="n">occ_alias</span><span class="p">,</span><span class="n">specie</span><span class="o">.</span><span class="n">position</span><span class="p">,</span><span class="n">int_flags</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">coords</span><span class="o">+=</span> <span class="p">[(</span><span class="n">specie</span><span class="o">.</span><span class="n">occ_alias</span><span class="p">,</span><span class="n">specie</span><span class="o">.</span><span class="n">position</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_POSITIONS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="o">=</span><span class="n">coords</span>
            <span class="k">if</span> <span class="s2">&quot;SYSTEM&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="p">[</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;nat&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">poscar</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="p">[</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;ntyp&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">poscar</span><span class="o">.</span><span class="n">basis_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">if</span> <span class="s2">&quot;ATOMIC_SPECIES&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">specie</span> <span class="ow">in</span> <span class="n">poscar</span><span class="o">.</span><span class="n">basis_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">specie</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_SPECIES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: &quot;</span> <span class="o">+</span> <span class="n">specie</span> <span class="o">+</span> <span class="s2">&quot; in ATOMIC_POSITIONS does not have corresponding entry in ATOMIC_SPECIES&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">species</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Attempting to retrieve data for &quot;</span> <span class="o">+</span> <span class="n">specie</span> <span class="o">+</span> <span class="s2">&quot; from SPECIES file....&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">species</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">species</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">.</span><span class="n">alias</span> <span class="o">==</span> <span class="n">specie</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_SPECIES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">species</span><span class="o">+=</span> <span class="p">[</span><span class="n">specie</span><span class="p">]</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_SPECIES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">masses</span><span class="o">+=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="c1">#look up masses here????</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="p">[</span><span class="s2">&quot;CONTROL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;pseudo_dir&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">species</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">.</span><span class="n">pseudo_base</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_SPECIES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pseudos</span><span class="o">+=</span> <span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">.</span><span class="n">pseudo_location</span><span class="p">]</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found! &quot;</span> <span class="o">+</span> <span class="n">specie</span> <span class="o">+</span> <span class="s2">&quot; in SPECIES file with pseudopotential at &quot;</span> <span class="o">+</span> <span class="n">species</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">.</span><span class="n">pseudodir</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span> 
                                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: PSEUDO_DIR_PATH in SPECIES file does not match &#39;pseudo_dir&#39; tag in &amp;CONTROL namelist of Infile&quot;</span><span class="p">)</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WILL ASSUME &#39;pseudo_dir&#39; tag is correct&quot;</span><span class="p">)</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_SPECIES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pseudos</span><span class="o">+=</span> <span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">.</span><span class="n">pseudo_location</span><span class="p">]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Search failed! No data for &quot;</span> <span class="o">+</span> <span class="n">specie</span> <span class="o">+</span> <span class="s2">&quot; to be found&quot;</span><span class="p">)</span> 
                <span class="k">for</span> <span class="n">specie</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_SPECIES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">specie</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">poscar</span><span class="o">.</span><span class="n">basis_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">index</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_SPECIES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">specie</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_SPECIES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_SPECIES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">masses</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="s2">&quot;ATOMIC_SPECIES&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pseudos</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">infile_write</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">for</span> <span class="n">namelist</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">QUANTUM_ESPRESSO_NAMELIST_LIST</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="p">[</span><span class="n">namelist</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="p">[</span><span class="n">namelist</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">namelist</span> <span class="ow">in</span> <span class="n">QUANTUM_ESPRESSO_NAMELIST_OBJ_LIST</span><span class="p">:</span>
                    <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">remove_chars</span><span class="p">(</span><span class="s1">&#39;&amp;</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namelist</span><span class="p">),</span><span class="s2">&quot;[\[\],]&#39;&quot;</span><span class="p">))</span>
                    <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">remove_chars</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="p">[</span><span class="n">namelist</span><span class="p">]</span><span class="o">.</span><span class="n">make_string</span><span class="p">()),</span><span class="s2">&quot;[\[\]]&#39;&quot;</span><span class="p">))</span>
                    <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;/</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#This branch is for namelists unrecognized by the qe wrapper</span>
                    <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">remove_chars</span><span class="p">(</span><span class="s1">&#39;&amp;</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namelist</span><span class="p">),</span><span class="s2">&quot;[\[\],]&#39;&quot;</span><span class="p">))</span>
                    <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">remove_chars</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">namelists</span><span class="p">[</span><span class="n">namelist</span><span class="p">]),</span><span class="s2">&quot;[\[\]]&#39;&quot;</span><span class="p">))</span>
                    <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;/</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">QUANTUM_ESPRESSO_CARD_LIST</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="n">card</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="n">card</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">QUANTUM_ESPRESSO_CARD_OBJ_LIST</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">card</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ATOMIC_POSITIONS&quot;</span><span class="p">,</span><span class="s2">&quot;K_POINTS&quot;</span><span class="p">,</span><span class="s2">&quot;CELL_PARAMETERS&quot;</span><span class="p">]:</span>
                        <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="n">card</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card</span><span class="p">))</span>
                    <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">remove_chars</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="n">card</span><span class="p">]</span><span class="o">.</span><span class="n">make_string</span><span class="p">()),</span><span class="s2">&quot;[\[\]]&#39;&quot;</span><span class="p">))</span>
                    <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#This branch is for cards unrecognized by the qe wrapper</span>
                    <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">card</span><span class="p">))</span>
                    <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">remove_chars</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cards</span><span class="p">[</span><span class="n">card</span><span class="p">]),</span><span class="s2">&quot;[\[\]]&#39;&quot;</span><span class="p">))</span>
                    <span class="n">infile_write</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">infile_write</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, CASM Developers.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'0.3.dev',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>